{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useCallback,useState,useRef}from'react';import{Form,Row,Col,Input,Button,Space,Spin,message}from'antd';import{useNavigate}from'react-router';import PeopleCard from'./PeopleCard';import ProcessDataCard from'./ProcessDataCard';import ExpertiseCard from'./ExpertiseCard';import ExtraCard from'./ExtraCard/ExtraCard';import styled from'styled-components';import useSaveProcess from'./useSaveProcess';import messageError from'Utils/messageError';import successModal from'Utils/successModal';import useGetPrevisionDate from'./useGetPrevisionDate';import FilesCard from'./Files/FilesCard';import useGetProcess from'./useGetProcess';import moment from'moment';import useGetPeople from'Components/Inputs/PersonInput/useGetPeople';import useGetUsers from'Components/Inputs/PersonInput/useGetUsers';import CompanyInput from'Components/Inputs/CompanyInput/CompanyInput';import ImportButton from'./ImportButton';import{useUserSelector}from'Redux/UserReducer';import AdditionalPushModal from'./AdditionalPushModal/AdditionalPushModal';var prevision_date_count=0;var DATE_FIELDS=['appointmentDate','expertiseDate','previsionReport','deliveryReport','clarificationReport','clarificationDeliveryReport','dateImpugnment','previsionImpugnment','deliveryImpugnment','clarificationImpugnment','clarificationDeliveryImpugnment','createAt'];var ProcessForm=function ProcessForm(_ref){var id=_ref.id;var _useState=useState(),_useState2=_slicedToArray(_useState,2),import_key=_useState2[0],setImportKey=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),push_description=_useState4[0],setPushDescription=_useState4[1];var additionalPushModalRef=useRef(null);var _useGetPeople=useGetPeople(),_useGetPeople2=_slicedToArray(_useGetPeople,2),_useGetPeople2$=_useGetPeople2[0],_useGetPeople2$$data=_useGetPeople2$.data,people=_useGetPeople2$$data===void 0?[]:_useGetPeople2$$data,people_loading=_useGetPeople2$.loading,getPeople=_useGetPeople2[1];var _useGetUsers=useGetUsers(),_useGetUsers2=_slicedToArray(_useGetUsers,2),_useGetUsers2$=_useGetUsers2[0],_useGetUsers2$$data=_useGetUsers2$.data,users=_useGetUsers2$$data===void 0?[]:_useGetUsers2$$data,users_loading=_useGetUsers2$.loading,getUsers=_useGetUsers2[1];var _useSaveProcess=useSaveProcess(),_useSaveProcess2=_slicedToArray(_useSaveProcess,2),saveProcess=_useSaveProcess2[0],save_loading=_useSaveProcess2[1].loading;var _useGetProcess=useGetProcess(),_useGetProcess2=_slicedToArray(_useGetProcess,2),_useGetProcess2$=_useGetProcess2[0],data=_useGetProcess2$.data,loading=_useGetProcess2$.loading,getProcess=_useGetProcess2[1];// TODO: Colocar no campo de datas para ficar mais facil de fazer a lógica\nvar _useGetPrevisionDate=useGetPrevisionDate(),_useGetPrevisionDate2=_slicedToArray(_useGetPrevisionDate,2),getPrevisionDate=_useGetPrevisionDate2[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var navigate=useNavigate();var plan_modules=useUserSelector(function(state){var _state$company;return(_state$company=state.company)===null||_state$company===void 0?void 0:_state$company.plan.modules;});var setFormValues=function setFormValues(process){var _process$annotation;Object.entries(process).forEach(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1];if(DATE_FIELDS.includes(key)&&value){// @ts-ignore\nprocess[key]=moment(value,'YYYY-MM-DD');}});var values=_objectSpread({},process,{peoples:formatPeopleValuesToForm(process.peoples||[]),activePole:formatPeopleValuesToForm(process.activePole||[]),passivePole:formatPeopleValuesToForm(process.passivePole||[]),responsibles:formatPeopleValuesToForm(process.responsibles||[]),annotation:(_process$annotation=process.annotation)===null||_process$annotation===void 0?void 0:_process$annotation.map(function(annotation){return _objectSpread({},annotation,{key:annotation._id});}),acceptAppointment:process.acceptAppointment===undefined||process.acceptAppointment===null?undefined:process.acceptAppointment?'true':'false',freeJustice:process.freeJustice===undefined||process.freeJustice===null?undefined:process.freeJustice?'true':'false',favorite:process.favorite===undefined||process.favorite===null?undefined:process.favorite?'true':'false'});delete values['movements'];form.setFieldsValue(values);};var loadProcess=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _process$push,response,process;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(id){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;_context.next=5;return getProcess(id);case 5:response=_context.sent;process=response.data;setImportKey(process.statusImport_key);setPushDescription((_process$push=process.push)===null||_process$push===void 0?void 0:_process$push.push_description);setFormValues(process);_context.next=16;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](2);messageError('20200022127');console.log(_context.t0);case 16:case\"end\":return _context.stop();}}},_callee,null,[[2,12]]);}));return function loadProcess(){return _ref4.apply(this,arguments);};}();useEffect(function(){loadProcess();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var formatPeopleValuesToForm=function formatPeopleValuesToForm(people){var new_peoples=[];people===null||people===void 0?void 0:people.forEach(function(person){new_peoples.push({kindPeopleId:person.kindPeople.kindPeople_id,peopleId:person.people.people_id});});return new_peoples;};var normalizeValues=function normalizeValues(values){Object.entries(values).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],value=_ref6[1];if(DATE_FIELDS.includes(key)&&value){values[key]=value.format('YYYY-MM-DD');}});return _objectSpread({},values,{annotation:values.annotation?JSON.stringify(values.annotation):undefined,peoples:formatPeopleValues(values.peoples),activePole:formatPeopleValues(values.activePole),passivePole:formatPeopleValues(values.passivePole),responsibles:formatPeopleValues(values.responsibles),acceptAppointment:values.acceptAppointment===undefined?undefined:values.acceptAppointment==='true',freeJustice:values.freeJustice===undefined?undefined:values.freeJustice==='true'});};var formatPeopleValues=function formatPeopleValues(people){var new_peoples=[];people===null||people===void 0?void 0:people.forEach(function(person){if(!person.kindPeopleId||!person.peopleId)return;new_peoples.push({kindPeople:{kindPeople_id:person.kindPeopleId},people:{people_id:person.peopleId}});});return JSON.stringify(new_peoples);};var handleFormFinish=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(raw_values){var values,response,_additionalPushModalR;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:values=normalizeValues(raw_values);_context2.prev=1;_context2.next=4;return saveProcess(values);case 4:response=_context2.sent;console.log('RESPONSE SAVE PROCESS =>',response);if(!response.data.success){_context2.next=10;break;}successModal({content:'Processo salvo com sucesso'});setTimeout(function(){navigate('/process-list');},1500);return _context2.abrupt(\"return\");case 10:if(!(response.data.key==='aditional_push')){_context2.next=13;break;}(_additionalPushModalR=additionalPushModalRef.current)===null||_additionalPushModalR===void 0?void 0:_additionalPushModalR.open();return _context2.abrupt(\"return\");case 13:message.error(response.data.message);_context2.next=20;break;case 16:_context2.prev=16;_context2.t0=_context2[\"catch\"](1);messageError('202008310110');console.log('[ProcessForm] ',_context2.t0);case 20:case\"end\":return _context2.stop();}}},_callee2,null,[[1,16]]);}));return function handleFormFinish(_x){return _ref7.apply(this,arguments);};}();var importProcess=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var values;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return form.validateFields();case 3:values=_context3.sent;handleFormFinish(_objectSpread({},values,{statusProcessMonitoring:true}));_context3.next=9;break;case 7:_context3.prev=7;_context3.t0=_context3[\"catch\"](0);case 9:case\"end\":return _context3.stop();}}},_callee3,null,[[0,7]]);}));return function importProcess(){return _ref8.apply(this,arguments);};}();// TODO: refatorar este código maravilhoso\nvar previsionDate=function previsionDate(changed_values,all_values){var key=Object.keys(changed_values)[0];if(['expertiseDate','reportDays','typeReportDays'].includes(key)&&all_values.expertiseDate&&all_values.reportDays&&all_values.typeReportDays!==undefined){clearTimeout(prevision_date_count);prevision_date_count=setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var response;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return getPrevisionDate({data:{typeDocument:'report',expertiseDate:all_values.expertiseDate.format('YYYY-MM-DD'),reportDays:all_values.reportDays,typeReportDays:all_values.typeReportDays}});case 2:response=_context4.sent;if(response.data.success){form.setFieldsValue({'previsionReport':moment(response.data.previsionReport,'YYYY-MM-DD')});}case 4:case\"end\":return _context4.stop();}}},_callee4);})),800);return;}if(['dateImpugnment','impugnmentDays','typeImpugnmentDays'].includes(key)&&all_values.dateImpugnment&&all_values.impugnmentDays&&all_values.typeImpugnmentDays!==undefined){clearTimeout(prevision_date_count);prevision_date_count=setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){var response;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return getPrevisionDate({data:{typeDocument:'impugnment',dateImpugnment:all_values.dateImpugnment.format('YYYY-MM-DD'),impugnmentDays:all_values.impugnmentDays,typeImpugnmentDays:all_values.typeImpugnmentDays}});case 2:response=_context5.sent;if(response.data.success){form.setFieldsValue({'previsionImpugnment':moment(response.data.previsionImpugnment,'YYYY-MM-DD')});}case 4:case\"end\":return _context5.stop();}}},_callee5);})),800);}};var fecthPersonData=useCallback(function(){getPeople();getUsers();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){fecthPersonData();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var addAdditionalPush=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _additionalPushModalR2,values;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.prev=0;(_additionalPushModalR2=additionalPushModalRef.current)===null||_additionalPushModalR2===void 0?void 0:_additionalPushModalR2.close();_context6.next=4;return form.validateFields();case 4:values=_context6.sent;handleFormFinish(_objectSpread({},values,{additionalPush:true,statusProcessMonitoring:true}));_context6.next=11;break;case 8:_context6.prev=8;_context6.t0=_context6[\"catch\"](0);console.log('[NewProcess] ',_context6.t0);case 11:case\"end\":return _context6.stop();}}},_callee6,null,[[0,8]]);}));return function addAdditionalPush(){return _ref11.apply(this,arguments);};}();var all_person_data=[];var all_users_data=[];people.forEach(function(person){return all_person_data.push(_objectSpread({},person,{type:'people'}));});users.forEach(function(user){all_users_data.push(_objectSpread({},user,{type:'user'}));all_person_data.push(_objectSpread({},user,{type:'user'}));});return/*#__PURE__*/React.createElement(Form,{layout:\"vertical\",form:form,initialValues:{peoples:[{}],activePole:[{}],passivePole:[{}],statusProcessMonitoring:false},onFinish:handleFormFinish,onValuesChange:previsionDate},/*#__PURE__*/React.createElement(Spin,{spinning:loading||save_loading},/*#__PURE__*/React.createElement(Row,{gutter:40},/*#__PURE__*/React.createElement(Col,{span:10},/*#__PURE__*/React.createElement(Row,{gutter:8},/*#__PURE__*/React.createElement(Col,{span:12},/*#__PURE__*/React.createElement(Form.Item,{name:\"_id\",noStyle:true},/*#__PURE__*/React.createElement(Input,{type:\"hidden\"})),/*#__PURE__*/React.createElement(Form.Item,{name:\"statusImport_key\",noStyle:true},/*#__PURE__*/React.createElement(Input,{type:\"hidden\"})),/*#__PURE__*/React.createElement(Form.Item,{name:\"processNumber\",rules:[{required:true,message:'Campo obrigatório'}]},/*#__PURE__*/React.createElement(Input,{autoFocus:true,placeholder:\"Informe o n\\xFAmero do processo\"}))),/*#__PURE__*/React.createElement(Col,{span:12},/*#__PURE__*/React.createElement(Form.Item,{name:\"internalCode\"},/*#__PURE__*/React.createElement(Input,{placeholder:\"Controle Interno\"}))),(plan_modules===null||plan_modules===void 0?void 0:plan_modules.Multicompany)&&/*#__PURE__*/React.createElement(Col,{span:12},/*#__PURE__*/React.createElement(Form.Item,{name:\"multicompany_id\"},/*#__PURE__*/React.createElement(CompanyInput,{allowClear:true,showSearch:true,placeholder:\"Empresa\"})))))),/*#__PURE__*/React.createElement(Row,{gutter:40,style:{marginBottom:24}},/*#__PURE__*/React.createElement(Col,{span:10},/*#__PURE__*/React.createElement(ImportButton,{loading:save_loading,disabled:loading||save_loading,import_key:import_key,description:push_description,importProcess:importProcess}))),/*#__PURE__*/React.createElement(Row,{gutter:40},/*#__PURE__*/React.createElement(Col,{span:10},/*#__PURE__*/React.createElement(Row,{gutter:8},/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(PeopleCard,{title:\"Peritos e assistentes\",field_name:\"responsibles\",options:all_users_data,refetch:fecthPersonData,loading:users_loading})),/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(PeopleCard,{title:\"Polo Ativo\",field_name:\"activePole\",options:all_person_data,refetch:fecthPersonData,loading:people_loading||users_loading})),/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(PeopleCard,{title:\"Polo Passivo\",field_name:\"passivePole\",options:all_person_data,refetch:fecthPersonData,loading:people_loading||users_loading})),/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(PeopleCard,{title:\"Pessoas\",field_name:\"peoples\",options:all_person_data,refetch:fecthPersonData,loading:people_loading||users_loading})),/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(Form.Item,{noStyle:true,shouldUpdate:function shouldUpdate(prev,next){return prev._id!==next._id;}},function(_ref12){var getFieldValue=_ref12.getFieldValue;var process_id=getFieldValue('_id');return/*#__PURE__*/React.createElement(FilesCard,{process_id:process_id});})))),/*#__PURE__*/React.createElement(Col,{span:14},/*#__PURE__*/React.createElement(Row,{gutter:8},/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(ProcessDataCard,{setFieldsValue:form.setFieldsValue})),/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(ExpertiseCard,null)),/*#__PURE__*/React.createElement(Col,{span:24},/*#__PURE__*/React.createElement(ExtraCard,{movements:(data===null||data===void 0?void 0:data.movements)||[]})))))),/*#__PURE__*/React.createElement(Footer,{justify:\"end\"},/*#__PURE__*/React.createElement(Space,null,/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return navigate('/process-list');}},\"Cancelar\"),/*#__PURE__*/React.createElement(Button,{disabled:loading||save_loading,loading:save_loading,type:\"primary\",htmlType:\"submit\"},\"Salvar\"))),/*#__PURE__*/React.createElement(AdditionalPushModal,{onAccept:addAdditionalPush,ref:additionalPushModalRef}));};ProcessForm.displayName=\"ProcessForm\";export default ProcessForm;var Footer=styled(Row).withConfig({displayName:\"ProcessForm__Footer\",componentId:\"sc-1xq5h3u-0\"})([\"width:100%;position:sticky;bottom:-20px;background:white;padding:8px 0;\"]);","map":null,"metadata":{},"sourceType":"module"}