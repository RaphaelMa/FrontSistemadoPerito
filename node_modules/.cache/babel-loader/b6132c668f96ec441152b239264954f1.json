{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useRef,useCallback}from'react';import{useNavigate,useParams}from'react-router';import{CKEditor}from'@ckeditor/ckeditor5-react';import{Button,Col,Input,message,Row}from'antd';import{useUserSelector}from'Redux/UserReducer';import Editor from'ckeditor5-custom-build/build/ckeditor';import VariablesInput from'./VariablesInput';import styled from'styled-components';import useGetDocument from'./useGetDocument';import messageError from'Utils/messageError';import useSaveDocument from'./useSaveDocument';import successModal from'Utils/successModal';var Document=function Document(){var permissions=useUserSelector(function(state){return state.permissions;});var _useParams=useParams(),id=_useParams.id;var navigate=useNavigate();var _useGetDocument=useGetDocument(),_useGetDocument2=_slicedToArray(_useGetDocument,2),getDocument=_useGetDocument2[0],loading=_useGetDocument2[1].loading;var _useSaveDocument=useSaveDocument(),_useSaveDocument2=_slicedToArray(_useSaveDocument,2),saveDocument=_useSaveDocument2[0],save_loading=_useSaveDocument2[1].loading;var _useState=useState(),_useState2=_slicedToArray(_useState,2),title=_useState2[0],setTitle=_useState2[1];var editorRef=useRef(null);var loadDocument=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var response,_response$data,_document;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getDocument(id);case 3:response=_context.sent;_response$data=response===null||response===void 0?void 0:response.data,_document=_response$data.document;if(editorRef.current){_context.next=7;break;}return _context.abrupt(\"return\");case 7:setTitle(_document.title);editorRef.current.data.set(_document.data);_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);messageError('202108222039');console.error(_context.t0);case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function(_x){return _ref.apply(this,arguments);};}(),[getDocument]);useEffect(function(){if(!permissions.document.read){navigate('/');return;}if(!id)return;loadDocument(id);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[id]);var addVariable=function addVariable(variable){if(!editorRef.current){message.error('Erro ao carregar o editor de texto. Recarregue a página e tente novamente. Se o error '+'persistir entre contato conosco. Código do erro: 2021221819');return;}editorRef.current.model.change(function(writer){writer.insertText(\"\".concat(variable,\" \"),editorRef.current.model.document.selection.getFirstPosition());});};var handleSaveDocument=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var data,response,success;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(title){_context2.next=3;break;}message.info('Informe o título do documento!');return _context2.abrupt(\"return\");case 3:data={_id:id,title:title,data:editorRef.current.getData()};_context2.next=6;return saveDocument(data);case 6:response=_context2.sent;success=response.data.success;if(!success){_context2.next=12;break;}successModal({content:'Documento salvo com sucesso'});setTimeout(function(){return navigate('/documents');},1500);return _context2.abrupt(\"return\");case 12:message.error(response.data.message);case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSaveDocument(){return _ref2.apply(this,arguments);};}();var can_edit=!!id&&permissions.document.update;var can_create=!id&&permissions.document.create;return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Header,null,/*#__PURE__*/React.createElement(Row,{gutter:10,style:{width:'100%'}},/*#__PURE__*/React.createElement(Col,{flex:\"400px\"},/*#__PURE__*/React.createElement(Input,{value:title,onChange:function onChange(event){return setTitle(event.target.value);},placeholder:\"T\\xEDtulo do Documento\"})),/*#__PURE__*/React.createElement(Col,{flex:\"250px\"},/*#__PURE__*/React.createElement(VariablesInput,{type:\"people\",addVariable:addVariable})),/*#__PURE__*/React.createElement(Col,{flex:\"250px\"},/*#__PURE__*/React.createElement(VariablesInput,{type:\"process\",addVariable:addVariable}))),/*#__PURE__*/React.createElement(\"div\",null,(can_edit||can_create)&&/*#__PURE__*/React.createElement(Button,{type:\"primary\",onClick:handleSaveDocument,loading:loading||save_loading},\"Salvar\"))),/*#__PURE__*/React.createElement(\"div\",{class:\"document-editor__toolbar\"}),/*#__PURE__*/React.createElement(EditorRow,null,/*#__PURE__*/React.createElement(\"div\",{className:\"editor-container\"},/*#__PURE__*/React.createElement(CKEditor,{editor:Editor,config:{toolbar:['undo','redo','pageBreak','horizontalLine','heading','|','fontSize','fontFamily','fontColor','fontBackgroundColor','|','bold','italic','underline','strikethrough','|','numberedList','bulletedList','todoList','|','outdent','indent','alignment','|','link','insertTable','mediaEmbed','imageInsert','|','highlight','findAndReplace'],language:'pt-br',table:{contentToolbar:['tableColumn','tableRow','mergeTableCells','tableCellProperties','tableProperties']},licenseKey:''},onReady:function onReady(editor){// You can store the \"editor\" and use when it is needed.\neditorRef.current=editor;if(!permissions.document.read)return;document.querySelector('.document-editor__toolbar').appendChild(editor.ui.view.toolbar.element);document.querySelector('.ck-toolbar').classList.add('ck-reset_all');}}))));};Document.displayName=\"Document\";export default Document;var Container=styled.div.withConfig({displayName:\"Document__Container\",componentId:\"kcin10-0\"})([\"padding:20px;\"]);var EditorRow=styled.div.withConfig({displayName:\"Document__EditorRow\",componentId:\"kcin10-1\"})([\"display:flex;justify-content:center;padding-top:20px;padding-bottom:20px;background:#f2f2f2;border:1px solid hsl(0,0%,77%);height:calc(100vh - 50px - 52px - 40px - 40px);overflow:auto;h1{font-weight:bold;}.editor-container{width:100%;max-width:700px;height:fit-content;background:white;border:1px hsl( 0,0%,82.7% ) solid;box-shadow:0 0 5px hsl(0deg 0% 0% / 10%);}.ck-editor__editable{min-height:700px;padding:40px !important;}\"]);var Header=styled.div.withConfig({displayName:\"Document__Header\",componentId:\"kcin10-2\"})([\"display:flex;justify-content:space-between;margin-bottom:20px;\"]);","map":null,"metadata":{},"sourceType":"module"}