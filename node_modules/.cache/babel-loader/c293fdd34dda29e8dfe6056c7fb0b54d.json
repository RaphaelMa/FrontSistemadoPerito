{"ast":null,"code":"import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import FinancialTable from'Pages/Financial/FinancialTable';import useGetProcessFinancial from'./useGetProcessFianancial';import messageError from'Utils/messageError';import styled from'styled-components';import{Button,Row}from'antd';import{useParams}from'react-router';import{currencyFormatter}from'Utils/formatters';import MenuTop from'Pages/NewProcess/MenuTop';import FinancialDrawer from'Components/Drawers/Financial/FinancialDrawer';import{filterData}from'Utils/functions';import{useUserSelector}from'Redux/UserReducer';import PermissionsContainer from'Components/Permissions/Container';var initial_filters={pagination:{current_page:1,page_size:20},sort:{field:'expirationDate',order:'ascend'}};var FinaceProcess=function FinaceProcess(){var _useParams=useParams(),id=_useParams.id;var permissions=useUserSelector(function(state){return state.permissions;});var plan_modules=useUserSelector(function(state){var _state$company;return(_state$company=state.company)===null||_state$company===void 0?void 0:_state$company.plan.modules;});var financialModalRef=useRef(null);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),financials=_useState2[0],setFinancials=_useState2[1];var _useState3=useState({totalPay:0,totalReceive:0}),_useState4=_slicedToArray(_useState3,2),totals=_useState4[0],setTotals=_useState4[1];var _useState5=useState(initial_filters),_useState6=_slicedToArray(_useState5,2),filters=_useState6[0],setFilters=_useState6[1];var _useGetProcessFinanci=useGetProcessFinancial(id),_useGetProcessFinanci2=_slicedToArray(_useGetProcessFinanci,2),loading=_useGetProcessFinanci2[0].loading,getFinancials=_useGetProcessFinanci2[1];var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _data$message,_data$message2,_data$message3,_yield$getFinancials,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!(plan_modules===null||plan_modules===void 0?void 0:plan_modules.Financial)||!(permissions===null||permissions===void 0?void 0:permissions.financial.read))){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;_context.next=5;return getFinancials();case 5:_yield$getFinancials=_context.sent;data=_yield$getFinancials.data;setFinancials(((_data$message=data.message)===null||_data$message===void 0?void 0:_data$message.dataFinancial)||[]);setTotals({totalPay:((_data$message2=data.message)===null||_data$message2===void 0?void 0:_data$message2.totalPay)||0,totalReceive:((_data$message3=data.message)===null||_data$message3===void 0?void 0:_data$message3.totalReceive)||0});_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](2);console.log('[FinanceProcess] ',{e:_context.t0});messageError('202102271547');case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,11]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();useEffect(function(){fetchData();// eslint-disable-next-line\n},[]);var handleOpenDrawer=function handleOpenDrawer(options){var _financialModalRef$cu;console.log('[FinanceProcess] ',options,id);(_financialModalRef$cu=financialModalRef.current)===null||_financialModalRef$cu===void 0?void 0:_financialModalRef$cu.open(options,id);};var handleTableChange=useCallback(function(pagination,_,sorter){var _sorter$column;var internal_filters=filters;if(sorter===null||sorter===void 0?void 0:(_sorter$column=sorter.column)===null||_sorter$column===void 0?void 0:_sorter$column.sorter){internal_filters=_objectSpread({},internal_filters,{sort:{order:sorter.order,field:sorter.field}});}internal_filters=_objectSpread({},internal_filters,{pagination:{current_page:pagination.current||internal_filters.pagination.current_page,page_size:pagination.pageSize||internal_filters.pagination.page_size}});setFilters(function(old_filters){return _objectSpread({},old_filters,{},internal_filters);});},[filters]);var filtered_data=useMemo(function(){return filterData({data:financials,filters:filters,columns_keys:[]});},[filters,financials]);return/*#__PURE__*/React.createElement(PermissionsContainer,{has_module:plan_modules===null||plan_modules===void 0?void 0:plan_modules.Financial,has_permission:permissions===null||permissions===void 0?void 0:permissions.financial.read},/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(MenuTop,{activePage:\"financial\",id:id}),/*#__PURE__*/React.createElement(Header,null,/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Totals,{$color:\"#2D8F8A\"},\"Total Recebido \",currencyFormatter(totals.totalReceive,{cents:true})),/*#__PURE__*/React.createElement(Totals,{$color:\"#FF4D4F\"},\"Total Pago \",currencyFormatter(totals.totalPay,{cents:true}))),/*#__PURE__*/React.createElement(Button,{type:\"primary\",onClick:function onClick(){return handleOpenDrawer();}},\"Nova movimenta\\xE7\\xE3o\")),/*#__PURE__*/React.createElement(FinancialTable,{loading:loading,financials:filtered_data,setFinancials:setFinancials,handleTableChange:handleTableChange,handleOpenDrawer:handleOpenDrawer,afterSave:fetchData,header_height:96}),/*#__PURE__*/React.createElement(FinancialDrawer,{afterSave:fetchData,ref:financialModalRef})));};FinaceProcess.displayName=\"FinaceProcess\";export default FinaceProcess;var Container=styled.div.withConfig({displayName:\"FinanceProcess__Container\",componentId:\"sc-1vbndh7-0\"})([\"height:calc(100vh - 5rem);padding:2rem;\"]);var Header=styled.div.withConfig({displayName:\"FinanceProcess__Header\",componentId:\"sc-1vbndh7-1\"})([\"display:flex;justify-content:space-between;margin-bottom:10px;\"]);var Totals=styled.div.withConfig({displayName:\"FinanceProcess__Totals\",componentId:\"sc-1vbndh7-2\"})([\"width:200px;display:flex;justify-content:center;align-items:center;border:1px solid \",\";color:\",\";padding:auto;margin-right:5px;\"],function(p){return p.$color;},function(p){return p.$color;});","map":null,"metadata":{},"sourceType":"module"}