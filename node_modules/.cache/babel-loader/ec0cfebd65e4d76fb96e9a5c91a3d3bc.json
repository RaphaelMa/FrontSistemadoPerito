{"ast":null,"code":"import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useRef,useState}from'react';import{Badge,Calendar,message,Spin}from'antd';import ScheduleModal from'Components/Modals/Schedule/ScheduleModal';import useGetScheduleData from'Pages/Schedule/useGetScheduleData';import moment,{defaultFormat}from'moment';import styled from'styled-components';import Header from'./Header';import{lighten}from'polished';import{normalizeString}from'../../Utils/functions';var NORMALIZED_STATUS={'Aguardando':'warning','Realizado':'success','Cancelado':'error'};var Schedule=function Schedule(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),raw_data=_useState2[0],setRawData=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),month_data_filtered=_useState4[0],setMonthDataFiltered=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),filters=_useState6[0],setFilters=_useState6[1];var _useState7=useState(undefined),_useState8=_slicedToArray(_useState7,2),date=_useState8[0],setDate=_useState8[1];var _useGetScheduleData=useGetScheduleData(),_useGetScheduleData2=_slicedToArray(_useGetScheduleData,2),loading=_useGetScheduleData2[0],getScheduleDates=_useGetScheduleData2[1];var scheduleModalRef=useRef(null);var fetchData=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(date){var _yield$getScheduleDat,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getScheduleDates(date);case 3:_yield$getScheduleDat=_context.sent;data=_yield$getScheduleDat.data;if(data){_context.next=7;break;}return _context.abrupt(\"return\");case 7:// setRawData(fake_data)\nsetRawData(data.month);setDate(date);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);message.error('Não foi possível carregar os dias do mês. Recarregue a página e tente novamente. '+'Se persistir o erro entre em contato conosco pelo código: 2008202138');case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function(_x){return _ref.apply(this,arguments);};}(),[getScheduleDates]);var loadData=function loadData(){var raw_date=window.localStorage.getItem('schedule_date');if(!raw_date){fetchData(moment());return;}try{var date_moment=moment(JSON.parse(raw_date),defaultFormat);fetchData(date_moment);}catch(e){console.log(e);fetchData(moment());}};useEffect(function(){loadData();// eslint-disable-next-line\n},[]);useEffect(function(){if(date){window.localStorage.setItem('schedule_date',JSON.stringify(date.format(defaultFormat)));}},[date]);useEffect(function(){setMonthDataFiltered(raw_data);},[raw_data]);var filterContent=useCallback(function(content){var filters_typed=filters;return content.filter(function(content){return Object.keys(filters_typed).reduce(function(acc,key){if(key==='deadLineDescription'){return acc&&content[key]===filters_typed[key];}var content_normalized=normalizeString(content[key]||'');var filter_content_normalized=normalizeString(filters_typed[key]);return acc&&content_normalized.includes(filter_content_normalized);},true);});},[filters]);var handleFilters=useCallback(function(){var data_filtered=raw_data.map(function(day){return _objectSpread({},day,{content:filterContent(day.content)});});setMonthDataFiltered(data_filtered);},[filterContent,raw_data]);useEffect(function(){if(filters){handleFilters();}},[filters,handleFilters]);var handleProcess=useCallback(function(id){var _scheduleModalRef$cur;(_scheduleModalRef$cur=scheduleModalRef.current)===null||_scheduleModalRef$cur===void 0?void 0:_scheduleModalRef$cur.open(id);},[]);var dateCellRender=useCallback(function(date){var _month_data_filtered$;if(!month_data_filtered.length)return[];var format_date=moment(date,defaultFormat).format('YYYY-MM-DD');var content=(_month_data_filtered$=month_data_filtered.find(function(month){return moment(month===null||month===void 0?void 0:month.date,defaultFormat).format('YYYY-MM-DD')===format_date;}))===null||_month_data_filtered$===void 0?void 0:_month_data_filtered$.content;return/*#__PURE__*/React.createElement(\"ul\",{className:\"events\"},(content||[]).map(function(process,index){var process_text=\"\".concat(process.deadLineDescription,\" - \").concat(process.hour,\" \").concat(process.processNumber,\" \").concat(process.expertName||'');return/*#__PURE__*/React.createElement(LiStyled,{key:index,$color:process.color,title:process_text,onClick:function onClick(){return handleProcess(process._id);}},/*#__PURE__*/React.createElement(Process,{style:{paddingLeft:3},$color:process.color,status:NORMALIZED_STATUS[process.status],text:process_text}));}));},[month_data_filtered,handleProcess]);var onPanelChange=useCallback(function(date){fetchData(date);setDate(date);},[fetchData]);var headerRender=useCallback(function(_ref2){var value=_ref2.value,onChange=_ref2.onChange;return/*#__PURE__*/React.createElement(Header,{value:value,onChange:onChange,setFilters:setFilters});},[setFilters]);var afterSave=useCallback(function(){fetchData(moment());},[fetchData]);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Spin,{spinning:loading},/*#__PURE__*/React.createElement(CalendarStyled,{fullscreen:true,dateCellRender:dateCellRender,onPanelChange:onPanelChange,value:date,headerRender:headerRender,mode:\"month\"})),/*#__PURE__*/React.createElement(ScheduleModal,{afterSave:afterSave,ref:scheduleModalRef}));};Schedule.displayName=\"Schedule\";export default Schedule;var Container=styled.div.withConfig({displayName:\"Schedule__Container\",componentId:\"sc-50c8ez-0\"})([\"padding:1rem;overflow-x:auto;height:calc(100vh - 5rem);user-select:none;\"]);var LiStyled=styled.li.withConfig({displayName:\"Schedule__LiStyled\",componentId:\"sc-50c8ez-1\"})([\"line-height:16px !important;color:\",\" !important;\"],function(p){return p.$color;});// @ts-ignore\nvar Process=styled(Badge).withConfig({displayName:\"Schedule__Process\",componentId:\"sc-50c8ez-2\"})([\"width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;font-size:1rem;cursor:pointer;background-color:\",\";border-radius:3px;border:1px solid \",\";.ant-badge-status-text{color:\",\";margin-left:3px;}\"],function(p){return lighten(0.7,p.$color);},function(p){return p.$color;},function(p){return p.$color;});var CalendarStyled=styled(Calendar).withConfig({displayName:\"Schedule__CalendarStyled\",componentId:\"sc-50c8ez-3\"})([\".ant-picker-cell,.ant-picker-cell-in-view{cursor:auto;}.ant-picker-calendar-date-content{height:unset !important;min-height:80px;}tr,td{vertical-align:top;}.ant-picker-calendar-date-value{display:flex;}\"]);","map":null,"metadata":{},"sourceType":"module"}