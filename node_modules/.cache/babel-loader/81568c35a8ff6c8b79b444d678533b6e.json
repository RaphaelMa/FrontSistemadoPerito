{"ast":null,"code":"import _toConsumableArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import HeaderActions from'Components/MainList/HeaderActions';import ContainerList from'Components/MainList/ContainerList';import{filterData,scapeRegex}from'Utils/functions';import Table from'./ProcessFinancialSituationTable';import useColumns from'./useColumns';import EmptyComponent from'Components/EmptyComponent/EmptyComponent';import useGetProcessFinancialSituations from'./useGetProcessFinancialSituations';import messageError from'Utils/messageError';import ProcessFinancialSituationDrawer from'Components/Drawers/ProcessFinancialSituation/ProcessFinancialSituation';import useDestroyProcessFinancialSituation from'./useDestroyProcessFinancialSituation';import{useUserSelector}from'Redux/UserReducer';import{message}from'antd';import useExportData from'./useExportData';var initial_filters={search:'',pagination:{current_page:1,page_size:20},sort:{field:'description',order:'ascend'}};var columns_keys=['description'];var ProcessFinancialSituationList=function ProcessFinancialSituationList(){var permissions=useUserSelector(function(state){return state.permissions;});var _useState=useState(initial_filters),_useState2=_slicedToArray(_useState,2),filters=_useState2[0],setFilters=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useGetProcessFinanci=useGetProcessFinancialSituations(),_useGetProcessFinanci2=_slicedToArray(_useGetProcessFinanci,2),loading=_useGetProcessFinanci2[0].loading,getProcessFinancialSituation=_useGetProcessFinanci2[1];var _useDestroyProcessFin=useDestroyProcessFinancialSituation(),_useDestroyProcessFin2=_slicedToArray(_useDestroyProcessFin,2),destroyProcessFinancialSituation=_useDestroyProcessFin2[0],destroy_loading=_useDestroyProcessFin2[1].loading;var processFinancialSituationDrawerRef=useRef(null);var loadProcessFinancialSituations=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getProcessFinancialSituation();case 3:response=_context.sent;setData(response.data);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);messageError('202008252245');case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function loadProcessFinancialSituations(){return _ref.apply(this,arguments);};}();useEffect(function(){loadProcessFinancialSituations();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var onPressEnter=useCallback(function(value){setFilters(function(old_filters){return _objectSpread({},old_filters,{search:scapeRegex(value)});});},[]);var handleOpenDrawer=function handleOpenDrawer(id){var _processFinancialSitu;(_processFinancialSitu=processFinancialSituationDrawerRef.current)===null||_processFinancialSitu===void 0?void 0:_processFinancialSitu.open(id);};var handleDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return destroyProcessFinancialSituation(id);case 3:response=_context2.sent;if(response.data.success){message.success('Situação financeira excluída com sucesso');setData(function(prev){return prev.filter(function(financial_situation){return financial_situation._id!==id;});});}_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);messageError('202008262002');case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function handleDelete(_x){return _ref2.apply(this,arguments);};}();var handleTableChange=useCallback(function(pagination,filter,sorter){var _sorter$column;var internal_filters=filters;if(sorter===null||sorter===void 0?void 0:(_sorter$column=sorter.column)===null||_sorter$column===void 0?void 0:_sorter$column.sorter){internal_filters=_objectSpread({},internal_filters,{sort:{order:sorter.order,field:sorter.field}});}internal_filters=_objectSpread({},internal_filters,{pagination:{current_page:pagination.current||internal_filters.pagination.current_page,page_size:pagination.pageSize||internal_filters.pagination.page_size}});setFilters(internal_filters);},[filters]);var locale=useMemo(function(){return{emptyText:(permissions===null||permissions===void 0?void 0:permissions.processFinancialSituation.create)&&/*#__PURE__*/React.createElement(EmptyComponent,{onClick:function onClick(){return handleOpenDrawer();},action_text:\"Nova Situa\\xE7\\xE3o\"})};},[permissions]);var afterSave=function afterSave(financial_situation){setData(function(prev){var prev_financial_situation=data.find(function(key){return key._id===financial_situation._id;});if(prev_financial_situation){var financial_situations=prev.filter(function(key){return key._id!==financial_situation._id;});return[].concat(_toConsumableArray(financial_situations),[financial_situation]);}return[].concat(_toConsumableArray(prev),[financial_situation]);});};var columns=useColumns({handleDelete:handleDelete,handleEdit:handleOpenDrawer});var filtered_data=useMemo(function(){return filterData({data:data,filters:filters,columns_keys:columns_keys});},[filters,data]);var exportToXLS=useExportData(filtered_data);return/*#__PURE__*/React.createElement(ContainerList,null,/*#__PURE__*/React.createElement(HeaderActions,{onPressEnter:onPressEnter,setFilters:setFilters,placeholder:\"Informe situa\\xE7\\xE3o financeira do processo\",button_text:\"Nova Situa\\xE7\\xE3o Financeira\",handleNew:handleOpenDrawer,has_create_permission:permissions===null||permissions===void 0?void 0:permissions.processFinancialSituation.create,exportToXLS:exportToXLS}),/*#__PURE__*/React.createElement(Table,{columns:columns,filtered_data:filtered_data,filters:filters,handleTableChange:handleTableChange,loading:loading||destroy_loading,locale:locale}),/*#__PURE__*/React.createElement(ProcessFinancialSituationDrawer,{ref:processFinancialSituationDrawerRef,afterSave:afterSave}));};ProcessFinancialSituationList.displayName=\"ProcessFinancialSituationList\";export default ProcessFinancialSituationList;","map":null,"metadata":{},"sourceType":"module"}