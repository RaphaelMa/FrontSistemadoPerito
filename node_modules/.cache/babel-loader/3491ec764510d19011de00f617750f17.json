{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,forwardRef,useImperativeHandle}from'react';import{Drawer,Form,Button,Spin,message}from'antd';import useGetPerson from'./useGetPerson';import useSavePerson from'./useSavePerson';import messageError from'Utils/messageError';import PersonForm from'./PersonForm';import styled from'styled-components';import moment from'moment';import successModal from'Utils/successModal';var Person=function Person(_ref,ref){var afterSave=_ref.afterSave;var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var _useState=useState(false),_useState2=_slicedToArray(_useState,2),visible=_useState2[0],setVisible=_useState2[1];var _useGetPerson=useGetPerson(),_useGetPerson2=_slicedToArray(_useGetPerson,2),getPerson=_useGetPerson2[0],loading=_useGetPerson2[1].loading;var _useSavePerson=useSavePerson(),_useSavePerson2=_slicedToArray(_useSavePerson,2),savePerson=_useSavePerson2[0],save_loading=_useSavePerson2[1].loading;var open=function open(id){if(id)loadPerson(id);setVisible(true);};var close=function close(){setVisible(false);form.resetFields();};useImperativeHandle(ref,function(){return{open:open,close:close};});var loadPerson=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var response,data,person;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getPerson(id);case 3:response=_context.sent;_context.next=10;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);messageError('202008222208');return _context.abrupt(\"return\");case 10:data=response.data.people;person=_objectSpread({},data,{birthday:data.birthday?moment(data.birthday,'YYYY-MM-DD'):undefined});form.setFieldsValue(person);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);}));return function loadPerson(_x){return _ref2.apply(this,arguments);};}();var save=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values){var response,success,person;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return savePerson(values);case 3:response=_context2.sent;_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);messageError('202008222139');return _context2.abrupt(\"return\");case 10:success=response.data.success;person=response.data.people;if(!success){_context2.next=17;break;}successModal({content:'Pessoa salva com sucesso'});afterSave(_objectSpread({},values,{_id:person._id}));close();return _context2.abrupt(\"return\");case 17:message.error(response.data.message);case 18:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return function save(_x2){return _ref3.apply(this,arguments);};}();var handleSave=function handleSave(){form.validateFields().then(function(values){return _objectSpread({},values,{birthday:values.birthday?moment(values.birthday).format('YYYY-MM-DD'):undefined});}).then(function(values){return save(values);});};return/*#__PURE__*/React.createElement(Drawer,{visible:visible,onClose:close,title:\"Pessoa\",width:700,footer:/*#__PURE__*/React.createElement(Footer,null,/*#__PURE__*/React.createElement(Button,{onClick:close},\"Cancelar\"),/*#__PURE__*/React.createElement(Button,{loading:loading||save_loading,onClick:handleSave,type:\"primary\"},\"Salvar\"))},/*#__PURE__*/React.createElement(Spin,{spinning:loading||save_loading},/*#__PURE__*/React.createElement(PersonForm,{form:form})));};Person.displayName=\"Person\";export default forwardRef(Person);var Footer=styled.div.withConfig({displayName:\"Person__Footer\",componentId:\"syz1pn-0\"})([\"text-align:right;button + button{margin-left:8px;}\"]);","map":null,"metadata":{},"sourceType":"module"}