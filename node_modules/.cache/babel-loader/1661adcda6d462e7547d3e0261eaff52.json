{"ast":null,"code":"var _jsxFileName = \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport React, { useCallback, useEffect, useMemo, useState, useRef } from 'react';\nimport useGetProcessTasks from './useGetProcessTasks';\nimport messageError from 'Utils/messageError';\nimport styled from 'styled-components';\nimport { Button, Col } from 'antd';\nimport { useParams } from 'react-router';\nimport { filterData } from 'Utils/functions';\nimport { useUserSelector } from 'Redux/UserReducer';\nimport PermissionsContainer from 'Components/Permissions/Container';\nimport useDestroyTask from 'Components/Modals/TaskModal/useDestroyTask';\nimport MenuTop from 'Pages/NewProcess/MenuTop';\nimport TasksTable from './TasksTable';\nimport useSaveTask from 'Components/Modals/TaskModal/useSaveTask';\nimport TaskModal from 'Components/Modals/TaskModal/TaskModal';\nimport successModal from 'Utils/successModal';\nconst initial_filters = {\n  pagination: {\n    current_page: 1,\n    page_size: 20\n  },\n  sort: {\n    field: 'expirationDate',\n    order: 'ascend'\n  }\n};\n\nconst ProcessTasks = () => {\n  const {\n    id\n  } = useParams();\n  const permissions = useUserSelector(state => state.permissions);\n  const plan_modules = useUserSelector(state => {\n    var _state$company;\n\n    return (_state$company = state.company) === null || _state$company === void 0 ? void 0 : _state$company.plan.modules;\n  });\n  const taskModalRef = useRef(null);\n  const [destroy] = useDestroyTask();\n  const [saveTask] = useSaveTask();\n  const [tasks, setTasks] = useState([]);\n  const [filters, setFilters] = useState(initial_filters);\n  const [{\n    loading\n  }, getFinancials] = useGetProcessTasks(id);\n  const fetchData = useCallback(async () => {\n    if (!(plan_modules === null || plan_modules === void 0 ? void 0 : plan_modules.Financial) || !(permissions === null || permissions === void 0 ? void 0 : permissions.financial.read)) return;\n\n    try {\n      const {\n        data\n      } = await getFinancials();\n      setTasks(data.message || []);\n    } catch (e) {\n      messageError('202102271547');\n    }\n  }, [getFinancials, permissions, plan_modules]);\n  useEffect(() => {\n    fetchData(); // eslint-disable-next-line\n  }, []);\n  const handleDelete = useCallback(async task_id => {\n    try {\n      const {\n        data\n      } = await destroy(task_id);\n      const {\n        success\n      } = data || {};\n\n      if (!success) {\n        messageError('202106122322');\n        return;\n      }\n\n      setTasks(old_tasks => old_tasks.filter(task_item => task_item._id !== task_id));\n    } catch (error) {\n      messageError('202106122323');\n    }\n  }, [destroy]);\n  const handleSave = useCallback(async task => {\n    try {\n      const {\n        data\n      } = await saveTask(task);\n      const {\n        success\n      } = data;\n\n      if (!success) {\n        messageError('202106122326');\n        return;\n      }\n\n      setTasks(old_tasks => old_tasks.map(raw_task => raw_task._id === task._id ? task : raw_task));\n    } catch (error) {\n      messageError('202106031552');\n    }\n  }, [saveTask]);\n  const handleTableChange = useCallback((pagination, _, sorter) => {\n    var _sorter$column;\n\n    let internal_filters = filters;\n\n    if (sorter === null || sorter === void 0 ? void 0 : (_sorter$column = sorter.column) === null || _sorter$column === void 0 ? void 0 : _sorter$column.sorter) {\n      internal_filters = { ...internal_filters,\n        sort: {\n          order: sorter.order,\n          field: sorter.field\n        }\n      };\n    }\n\n    internal_filters = { ...internal_filters,\n      pagination: {\n        current_page: pagination.current || internal_filters.pagination.current_page,\n        page_size: pagination.pageSize || internal_filters.pagination.page_size\n      }\n    };\n    setFilters(old_filters => ({ ...old_filters,\n      ...internal_filters\n    }));\n  }, [filters]);\n  const handleAction = useCallback((action, task) => {\n    if (action === 'destroy') {\n      handleDelete(task._id);\n    } else if (action === 'edit') {\n      var _taskModalRef$current;\n\n      taskModalRef === null || taskModalRef === void 0 ? void 0 : (_taskModalRef$current = taskModalRef.current) === null || _taskModalRef$current === void 0 ? void 0 : _taskModalRef$current.open(task._id);\n    } else {\n      handleSave({ ...task,\n        finished: !task.finished\n      });\n    }\n  }, [handleDelete, handleSave]);\n  const filtered_data = useMemo(() => filterData({\n    data: tasks,\n    filters,\n    columns_keys: []\n  }), [filters, tasks]);\n  const afterSave = useCallback(() => {\n    successModal({\n      content: 'Tarefa salva com sucesso!'\n    });\n    fetchData();\n  }, [fetchData]);\n  return /*#__PURE__*/React.createElement(PermissionsContainer, {\n    has_module: plan_modules === null || plan_modules === void 0 ? void 0 : plan_modules.Task,\n    has_permission: permissions === null || permissions === void 0 ? void 0 : permissions.task.read,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MenuTop, {\n    activePage: \"tasks\",\n    id: id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ButtonsWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    block: true,\n    type: \"primary\" // @ts-ignore\n    ,\n    onClick: () => {\n      var _taskModalRef$current2;\n\n      return taskModalRef === null || taskModalRef === void 0 ? void 0 : (_taskModalRef$current2 = taskModalRef.current) === null || _taskModalRef$current2 === void 0 ? void 0 : _taskModalRef$current2.open('', {\n        process_id: id\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 13\n    }\n  }, \"Nova Tarefa\"), /*#__PURE__*/React.createElement(Button, {\n    href: \"/tasks\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\",\n    type: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }\n  }, \"Ir Para Tarefas\"))), /*#__PURE__*/React.createElement(TasksTable, {\n    loading: loading,\n    handleAction: handleAction,\n    tasks: filtered_data,\n    handleTableChange: handleTableChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(TaskModal, {\n    afterSave: afterSave,\n    ref: taskModalRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }));\n};\n\n__signature__(ProcessTasks, \"useParams{{ id }}\\nuseUserSelector{permissions}\\nuseUserSelector{plan_modules}\\nuseRef{taskModalRef}\\nuseDestroyTask{[destroy]}\\nuseSaveTask{[saveTask]}\\nuseState{[tasks, setTasks]([])}\\nuseState{[filters, setFilters](initial_filters)}\\nuseGetProcessTasks{[{ loading }, getFinancials]}\\nuseCallback{fetchData}\\nuseEffect{}\\nuseCallback{handleDelete}\\nuseCallback{handleSave}\\nuseCallback{handleTableChange}\\nuseCallback{handleAction}\\nuseMemo{filtered_data}\\nuseCallback{afterSave}\", () => [useParams, useUserSelector, useUserSelector, useDestroyTask, useSaveTask, useGetProcessTasks]);\n\nProcessTasks.displayName = \"ProcessTasks\";\nconst _default = ProcessTasks;\nexport default _default;\nconst Container = styled.div.withConfig({\n  displayName: \"ProcessTasks__Container\",\n  componentId: \"sc-1n2ky8i-0\"\n})([\"height:calc(100vh - 5rem);padding:2rem;\"]);\nconst Header = styled.div.withConfig({\n  displayName: \"ProcessTasks__Header\",\n  componentId: \"sc-1n2ky8i-1\"\n})([\"display:flex;justify-content:flex-end;margin-bottom:10px;\"]);\nconst ButtonsWrapper = styled(Col).withConfig({\n  displayName: \"ProcessTasks__ButtonsWrapper\",\n  componentId: \"sc-1n2ky8i-2\"\n})([\"display:flex;flex-direction:row;gap:8px;\"]);\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(initial_filters, \"initial_filters\", \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\");\n  reactHotLoader.register(ProcessTasks, \"ProcessTasks\", \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\");\n  reactHotLoader.register(Container, \"Container\", \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\");\n  reactHotLoader.register(Header, \"Header\", \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\");\n  reactHotLoader.register(ButtonsWrapper, \"ButtonsWrapper\", \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\");\n  reactHotLoader.register(_default, \"default\", \"/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/raphael/Documents/Github/FrontSistemadoPerito/src/Pages/NewProcess/Tabs/ProcessTasks/ProcessTasks.tsx"],"names":["React","useCallback","useEffect","useMemo","useState","useRef","useGetProcessTasks","messageError","styled","Button","Col","useParams","filterData","useUserSelector","PermissionsContainer","useDestroyTask","MenuTop","TasksTable","useSaveTask","TaskModal","successModal","initial_filters","pagination","current_page","page_size","sort","field","order","ProcessTasks","id","permissions","state","plan_modules","company","plan","modules","taskModalRef","destroy","saveTask","tasks","setTasks","filters","setFilters","loading","getFinancials","fetchData","Financial","financial","read","data","message","e","handleDelete","task_id","success","old_tasks","filter","task_item","_id","error","handleSave","task","map","raw_task","handleTableChange","_","sorter","internal_filters","column","current","pageSize","old_filters","handleAction","action","open","finished","filtered_data","columns_keys","afterSave","content","Task","process_id","Container","div","Header","ButtonsWrapper"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useState, useRef } from 'react'\nimport useGetProcessTasks, { TaskType } from './useGetProcessTasks'\nimport messageError from 'Utils/messageError'\nimport styled from 'styled-components'\nimport { Button, Col } from 'antd'\nimport { useParams } from 'react-router'\nimport { filterData, FiltersType } from 'Utils/functions'\nimport { TablePaginationConfig } from 'antd/es/table'\nimport { useUserSelector } from 'Redux/UserReducer'\nimport PermissionsContainer from 'Components/Permissions/Container'\nimport useDestroyTask from 'Components/Modals/TaskModal/useDestroyTask'\nimport MenuTop from 'Pages/NewProcess/MenuTop'\nimport TasksTable from './TasksTable'\nimport useSaveTask from 'Components/Modals/TaskModal/useSaveTask'\nimport TaskModal, { TaskModalType } from 'Components/Modals/TaskModal/TaskModal'\nimport successModal from 'Utils/successModal'\n\nconst initial_filters: FiltersType = {\n  pagination: {\n    current_page: 1,\n    page_size: 20\n  },\n  sort: {\n    field: 'expirationDate',\n    order: 'ascend'\n  }\n}\n\nconst ProcessTasks: React.FC = () => {\n  const { id } = useParams()\n\n  const permissions = useUserSelector(state => state.permissions)\n  const plan_modules = useUserSelector(state => state.company?.plan.modules)\n  const taskModalRef = useRef<TaskModalType>(null)\n\n  const [destroy] = useDestroyTask()\n  const [saveTask] = useSaveTask()\n  const [tasks, setTasks] = useState<TaskType[]>([])\n  const [filters, setFilters] = useState<FiltersType>(initial_filters)\n\n  const [{ loading }, getFinancials] = useGetProcessTasks(id)\n\n  const fetchData = useCallback(async () => {\n    if (!plan_modules?.Financial || !permissions?.financial.read) return\n\n    try {\n      const { data } = await getFinancials()\n\n      setTasks(data.message || [])\n    } catch (e) {\n      messageError('202102271547')\n    }\n  }, [getFinancials, permissions, plan_modules])\n\n  useEffect(() => {\n    fetchData()\n    // eslint-disable-next-line\n  }, [])\n\n  const handleDelete = useCallback(async (task_id: string) => {\n    try {\n      const { data } = await destroy(task_id!)\n      const { success } = data || {}\n\n      if (!success) {\n        messageError('202106122322')\n        return\n      }\n\n      setTasks(old_tasks => old_tasks.filter(task_item => task_item._id !== task_id))\n    } catch (error) {\n      messageError('202106122323')\n    }\n  }, [destroy])\n\n  const handleSave = useCallback(async (task: any) => {\n    try {\n      const { data } = await saveTask(task)\n      const { success } = data\n\n      if (!success) {\n        messageError('202106122326')\n        return\n      }\n\n      setTasks(old_tasks => old_tasks.map(raw_task => raw_task._id === task._id ? task : raw_task))\n    } catch (error) {\n      messageError('202106031552')\n    }\n  }, [saveTask])\n\n  const handleTableChange = useCallback((pagination: TablePaginationConfig, _: any, sorter: any): void => {\n    let internal_filters: FiltersType = filters\n\n    if (sorter?.column?.sorter) {\n      internal_filters = { ...internal_filters, sort: { order: sorter.order, field: sorter.field } }\n    }\n\n    internal_filters = {\n      ...internal_filters,\n      pagination: {\n        current_page: pagination.current || internal_filters!.pagination!.current_page,\n        page_size: pagination.pageSize || internal_filters!.pagination!.page_size\n      }\n    }\n\n    setFilters((old_filters) => ({ ...old_filters, ...internal_filters }))\n  }, [filters])\n\n  const handleAction = useCallback((action: 'destroy' | 'edit' | 'action', task: TaskType) => {\n    if (action === 'destroy') {\n      handleDelete(task._id)\n    } else if (action === 'edit') {\n      taskModalRef?.current?.open(task._id)\n    } else {\n      handleSave({ ...task, finished: !task.finished })\n    }\n  }, [handleDelete, handleSave])\n\n  const filtered_data = useMemo(() => (\n    filterData({ data: tasks, filters, columns_keys: [] })\n  ), [filters, tasks])\n\n  const afterSave = useCallback(() => {\n    successModal({ content: 'Tarefa salva com sucesso!' })\n    fetchData()\n  }, [fetchData])\n\n  return (\n    <PermissionsContainer has_module={plan_modules?.Task} has_permission={permissions?.task.read}>\n      <Container>\n        <MenuTop activePage=\"tasks\" id={id}/>\n\n        <Header>\n          <ButtonsWrapper>\n            <Button\n              block\n              type=\"primary\"\n              // @ts-ignore\n              onClick={() => taskModalRef?.current?.open('', { process_id: id })}\n            >\n              Nova Tarefa\n            </Button>\n\n            <Button href=\"/tasks\" target=\"_blank\" rel=\"noopener noreferrer\" type=\"primary\">Ir Para Tarefas</Button>\n          </ButtonsWrapper>\n        </Header>\n\n        <TasksTable\n          loading={loading}\n          handleAction={handleAction}\n          tasks={filtered_data}\n          handleTableChange={handleTableChange}\n        />\n      </Container>\n\n      <TaskModal afterSave={afterSave} ref={taskModalRef}/>\n    </PermissionsContainer>\n  )\n}\n\nexport default ProcessTasks\n\nconst Container = styled.div`\n  height: calc(100vh - 5rem);\n  padding: 2rem;\n`\n\nconst Header = styled.div`\n  display: flex;\n  justify-content: flex-end;\n  margin-bottom: 10px;\n`\n\nconst ButtonsWrapper = styled(Col)`\n  display: flex;\n  flex-direction: row;\n  gap: 8px;\n`\n"]},"metadata":{},"sourceType":"module"}