{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef}from'react';import{Form,Row,Col,Space,Button,message}from'antd';import{useNavigate,useParams}from'react-router';import AditionalUserModal from'./AditionalUserModal';import UserForm from'./UserForm';import PermissionsForm from'./PermissionsForm';import styled from'styled-components';import moment from'moment';import messageError from'Utils/messageError';import successModal from'Utils/successModal';import useSaveUser from'./useSaveUser';import useGetUser from'./useGetUser';import{useUserSelector}from'Redux/UserReducer';import PermissionsContainer from'Components/Permissions/Container';var NewUser=function NewUser(){var permissions=useUserSelector(function(state){return state.permissions;});var kindUser=useUserSelector(function(state){return state.kindUser;});var aditionalUserModalRef=useRef(null);var _useParams=useParams(),id=_useParams.id;var navigate=useNavigate();var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var _useSaveUser=useSaveUser(),_useSaveUser2=_slicedToArray(_useSaveUser,2),saveUser=_useSaveUser2[0],loading=_useSaveUser2[1].loading;var _useGetUser=useGetUser(),_useGetUser2=_slicedToArray(_useGetUser,2),getUser=_useGetUser2[0],user_loading=_useGetUser2[1].loading;var DATE_FIELDS=['birthday','createAt'];// Se não tem permissão para ver tbm não pode acessar, verificação feita no routes.ts\nvar has_permission=!!id&&(permissions===null||permissions===void 0?void 0:permissions.user.update)||!id&&(permissions===null||permissions===void 0?void 0:permissions.user.create);var loadUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(user_id){var _data$kindUser,_data$professional,_yield$getUser,data,user_values;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getUser(user_id);case 3:_yield$getUser=_context.sent;data=_yield$getUser.data;Object.entries(data).forEach(function(_ref2){var _ref3=_slicedToArray(_ref2,2),key=_ref3[0],value=_ref3[1];if(DATE_FIELDS.includes(key)&&value){// @ts-ignore\ndata[key]=moment(value,'YYYY-MM-DD');}});user_values=_objectSpread({},data,{kindUser_id:(_data$kindUser=data.kindUser)===null||_data$kindUser===void 0?void 0:_data$kindUser.kindUser_id,professional_id:(_data$professional=data.professional)===null||_data$professional===void 0?void 0:_data$professional.professional_id});form.setFieldsValue(user_values);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);messageError('202010311510');console.log(_context.t0);case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function loadUser(_x){return _ref.apply(this,arguments);};}();useEffect(function(){if(id&&has_permission)loadUser(id);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[id]);var addAditionalUser=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _aditionalUserModalRe,values;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;(_aditionalUserModalRe=aditionalUserModalRef.current)===null||_aditionalUserModalRe===void 0?void 0:_aditionalUserModalRe.close();_context2.next=4;return form.validateFields();case 4:values=_context2.sent;handleFormFinish(_objectSpread({},values,{additionalUser:true}));_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.log('[NewUser] ',_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function addAditionalUser(){return _ref4.apply(this,arguments);};}();var normalizeValues=function normalizeValues(values){Object.entries(values).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],value=_ref6[1];if(DATE_FIELDS.includes(key)&&value){values[key]=value.format('YYYY-MM-DD');}});return values;};var handleFormFinish=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(raw_values){var values,response,key,_aditionalUserModalRe2;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:values=normalizeValues(raw_values);_context3.prev=1;_context3.next=4;return saveUser(values);case 4:response=_context3.sent;if(!response.data.success){_context3.next=9;break;}successModal({content:'Usuário salvo com sucesso'});setTimeout(function(){navigate('/users');},1500);return _context3.abrupt(\"return\");case 9:message.error(response.data.message);_context3.next=21;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](1);console.log('[NewUser] ',_context3.t0.response);key=_context3.t0.response.data.key;if(!(key==='aditional_user')){_context3.next=19;break;}(_aditionalUserModalRe2=aditionalUserModalRef.current)===null||_aditionalUserModalRe2===void 0?void 0:_aditionalUserModalRe2.open();return _context3.abrupt(\"return\");case 19:messageError('2020102046');console.log('[NewUser] ',_context3.t0);case 21:case\"end\":return _context3.stop();}}},_callee3,null,[[1,12]]);}));return function handleFormFinish(_x2){return _ref7.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(PermissionsContainer,{has_permission:has_permission},/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Form,{form:form,layout:\"vertical\",style:{width:'100%'},onFinish:handleFormFinish},(kindUser===null||kindUser===void 0?void 0:kindUser.kindUser_key)==='admin'?/*#__PURE__*/React.createElement(Row,{gutter:40},/*#__PURE__*/React.createElement(Col,{span:12},/*#__PURE__*/React.createElement(UserForm,{id:id,isAdmin:true})),/*#__PURE__*/React.createElement(Col,{span:12},/*#__PURE__*/React.createElement(PermissionsForm,null))):/*#__PURE__*/React.createElement(UserForm,{id:id}),/*#__PURE__*/React.createElement(Footer,{justify:\"end\"},/*#__PURE__*/React.createElement(Space,null,/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return navigate('/users');}},\"Cancelar\"),/*#__PURE__*/React.createElement(Button,{disabled:loading||user_loading,loading:loading||user_loading,type:\"primary\",htmlType:\"submit\"},\"Salvar\")))),/*#__PURE__*/React.createElement(AditionalUserModal,{onAccept:addAditionalUser,ref:aditionalUserModalRef})));};NewUser.displayName=\"NewUser\";export default NewUser;var Container=styled(Row).withConfig({displayName:\"NewUser__Container\",componentId:\"sc-1yg33zf-0\"})([\"overflow-y:auto;overflow-x:hidden;padding:20px 40px 0 40px;height:calc(100% - 5rem);\"]);var Footer=styled(Row).withConfig({displayName:\"NewUser__Footer\",componentId:\"sc-1yg33zf-1\"})([\"width:100%;position:sticky;bottom:43px;background:white;padding:8px 0;\"]);","map":null,"metadata":{},"sourceType":"module"}