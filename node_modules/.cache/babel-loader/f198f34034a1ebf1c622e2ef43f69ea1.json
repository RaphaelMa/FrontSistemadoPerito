{"ast":null,"code":"import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{memo,useState,useCallback,useRef,useEffect,useMemo}from'react';import{isEqual,cloneDeep}from'lodash';import{DragDropContext}from'react-beautiful-dnd';import TaskModal from'Components/Modals/TaskModal/TaskModal';import TaskColumnModal from'Components/Modals/TaskColumn/TaskColumnModal';import useSaveTask from'Components/Modals/TaskModal/useSaveTask';import useGetBoard from'./useGetBoard';import styled from'styled-components';import Column from'./Column/Column';import Header from'./Header';import moment from'moment';import useDeleteColumn from'./useDeleteColumn';import messageError from'Utils/messageError';var Tasks=function Tasks(){var taskModalRef=useRef(null);var taskColumnModalRef=useRef(null);var _useState=useState([]),_useState2=_slicedToArray(_useState,2),columns=_useState2[0],setColumns=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),filters=_useState4[0],setFilters=_useState4[1];var _useSaveTask=useSaveTask(),_useSaveTask2=_slicedToArray(_useSaveTask,1),saveTask=_useSaveTask2[0];var _useGetBoard=useGetBoard(),_useGetBoard2=_slicedToArray(_useGetBoard,2),getBoardData=_useGetBoard2[1];var _useDeleteColumn=useDeleteColumn(),_useDeleteColumn2=_slicedToArray(_useDeleteColumn,1),deleteColumn=_useDeleteColumn2[0];var loadBoard=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getBoardData,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getBoardData();case 2:_yield$getBoardData=_context.sent;data=_yield$getBoardData.data;setColumns(data.task);case 5:case\"end\":return _context.stop();}}},_callee);})),[getBoardData]);useEffect(function(){loadBoard();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var openTaskModal=useCallback(function(task_id){var _taskModalRef$current;(_taskModalRef$current=taskModalRef.current)===null||_taskModalRef$current===void 0?void 0:_taskModalRef$current.open(task_id);},[]);var openColumnModal=useCallback(function(id,name){var _taskColumnModalRef$c;(_taskColumnModalRef$c=taskColumnModalRef.current)===null||_taskColumnModalRef$c===void 0?void 0:_taskColumnModalRef$c.open(id,name);},[]);var save=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(task,old_columns,new_columns){var _yield$saveTask,data,_ref3,success;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setColumns(new_columns);_context2.prev=1;_context2.next=4;return saveTask(task);case 4:_yield$saveTask=_context2.sent;data=_yield$saveTask.data;_ref3=data||{},success=_ref3.success;if(!success){_context2.next=9;break;}return _context2.abrupt(\"return\");case 9:setColumns(old_columns);_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](1);setColumns(old_columns);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[1,12]]);}));return function(_x,_x2,_x3){return _ref2.apply(this,arguments);};}(),[saveTask]);var onDragEnd=useCallback(function(result){var destination=result.destination,source=result.source;if(!destination||isEqual(destination,source))return;var origin_index=columns.findIndex(function(column){return column.column_id===source.droppableId;});var destination_index=columns.findIndex(function(column){return column.column_id===destination.droppableId;});if(origin_index===-1||destination_index===-1)return;var new_columns=cloneDeep(columns);var task=new_columns[origin_index].tasks.splice(source.index,1)[0];task.column_id=columns[destination_index].column_id;task.column_description=columns[destination_index].description;new_columns[destination_index].tasks.splice(destination.index,0,task);save(task,columns,new_columns);},[columns,save]);var afterSaveTask=useCallback(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(task,old_column_id){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// const { column_id } = task\n// const destination_index = columns.findIndex(column => column.column_id === column_id)\n// if (destination_index === -1) return\n// const new_columns = cloneDeep(columns)\n// // Remove da coluna antiga quando o id da coluna Ã© editado\n// if (old_column_id && old_column_id !== column_id) {\n//   const origin_index = columns.findIndex(column => column.column_id === old_column_id)\n//   const task_index = new_columns[origin_index].tasks.findIndex(t => t._id === task._id)\n//   if (origin_index !== -1 && task_index !== -1) {\n//     new_columns[origin_index].tasks.splice(task_index, 1)\n//   }\n// }\n// const task_index = new_columns[destination_index].tasks.findIndex(t => t._id === task._id)\n// if (task_index === -1) {\n//   new_columns[destination_index].tasks.push(task)\n// } else {\n//   new_columns[destination_index].tasks[task_index] = task\n// }\n// setColumns(new_columns)\nloadBoard();case 1:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x4,_x5){return _ref4.apply(this,arguments);};}(),[loadBoard]);var afterSaveColumn=useCallback(function(column){// const new_columns = cloneDeep(columns)\n// const colum_index = new_columns.findIndex(c => c.column_id === column._id)\n// // Nova coluna\n// if (colum_index === -1) {\n//   new_columns.push({ column_id: column._id, description: column.description, order: column.order, tasks: [] })\n// // Atualizando coluna\n// } else {\n//   new_columns[colum_index].description = column.description\n//   new_columns[colum_index].order = column.order\n// }\n// setColumns(new_columns)\nloadBoard();},[loadBoard]);var afterDeleteTask=useCallback(function(colum_id,task_id){var origin_index=columns.findIndex(function(column){return column.column_id===colum_id;});if(origin_index===-1)return;var task_index=columns[origin_index].tasks.findIndex(function(task){return task._id===task_id;});if(task_index===-1)return;var new_columns=cloneDeep(columns);new_columns[origin_index].tasks.splice(task_index,1);setColumns(new_columns);},[columns]);var handleDeleteColumn=useCallback(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(id){var new_columns,colum_index,_yield$deleteColumn,data,_ref6,success;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:new_columns=cloneDeep(columns);colum_index=new_columns.findIndex(function(column){return column.column_id===id;});if(!(colum_index===-1)){_context4.next=4;break;}return _context4.abrupt(\"return\");case 4:new_columns.splice(colum_index,1);_context4.prev=5;_context4.next=8;return deleteColumn(id);case 8:_yield$deleteColumn=_context4.sent;data=_yield$deleteColumn.data;_ref6=data||{},success=_ref6.success;if(success){_context4.next=14;break;}messageError('2020106031740');return _context4.abrupt(\"return\");case 14:setColumns(new_columns);_context4.next=20;break;case 17:_context4.prev=17;_context4.t0=_context4[\"catch\"](5);messageError('2020106031740');case 20:case\"end\":return _context4.stop();}}},_callee4,null,[[5,17]]);}));return function(_x6){return _ref5.apply(this,arguments);};}(),[columns,deleteColumn]);var filtered_columns=useMemo(function(){var filtered_columns=columns;if(!!filters.column_id){filtered_columns=columns.filter(function(column){return column.column_id===filters.column_id;});}return filtered_columns.map(function(column){var tasks=column.tasks,rest=_objectWithoutProperties(column,[\"tasks\"]);var filtered_tasks=tasks.filter(function(task){if(filters.start_date&&moment(task.deliveryDate,'YYYY-MM-DD').isBefore(filters.start_date))return false;if(filters.end_date&&moment(task.deliveryDate,'YYYY-MM-DD').isAfter(filters.end_date))return false;if(filters.finished!==undefined&&filters.finished!==task.finished)return false;if(filters.process_id&&filters.process_id!==task.process_id)return false;if(filters.user_id&&filters.user_id!==task.user_id)return false;return true;});return _objectSpread({},rest,{tasks:filtered_tasks});});},[columns,filters]);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Header,{openTaskModal:openTaskModal,openColumnModal:openColumnModal,setFilters:setFilters,type:\"kanban\"}),/*#__PURE__*/React.createElement(BoardContainer,null,/*#__PURE__*/React.createElement(DragDropContext,{onDragEnd:onDragEnd},filtered_columns.map(function(column){return/*#__PURE__*/React.createElement(Column,{key:column.column_id,column_id:column.column_id,title:column.description,tasks:column.tasks,index:1,openColumnModal:openColumnModal,deleteColumn:handleDeleteColumn,openTaskModal:openTaskModal});}))),/*#__PURE__*/React.createElement(TaskModal,{ref:taskModalRef,afterSave:afterSaveTask,afterDeleteTask:afterDeleteTask}),/*#__PURE__*/React.createElement(TaskColumnModal,{ref:taskColumnModalRef,afterSave:afterSaveColumn}));};Tasks.displayName=\"Tasks\";export default memo(Tasks);var Container=styled.div.withConfig({displayName:\"Tasks__Container\",componentId:\"sc-1wexptd-0\"})([\"height:100%;width:100%;\"]);var BoardContainer=styled.div.withConfig({displayName:\"Tasks__BoardContainer\",componentId:\"sc-1wexptd-1\"})([\"display:flex;flex-flow:row nowrap;height:calc(100vh - 50px - 42px);width:100%;overflow-x:scroll;overflow-y:hidden;&::-webkit-scrollbar{height:9px;}&::-webkit-scrollbar-track{background:transparent;}&::-webkit-scrollbar-thumb{background-color:\",\";border-radius:20px;}scrollbar-width:9;scrollbar-color:\",\";\"],function(p){return p.theme.colors.dark_gray;},function(p){return p.theme.colors.dark_gray;});","map":null,"metadata":{},"sourceType":"module"}