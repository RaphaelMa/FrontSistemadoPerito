{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{forwardRef,useCallback,useImperativeHandle,useState}from'react';import{Form,message,Modal,Spin}from'antd';import{normalizeData}from'./functions';import useUpdateScheduleStatus from'./useUpdateScheduleStatus';import useGetProcessData from'./useGetProcessData';import successModal from'Utils/successModal';import useGetStatus from'./useGetStatus';import Content from'./Content/Content';import messageError from'Utils/messageError';var ScheduleModal=function ScheduleModal(_ref,ref){var afterSave=_ref.afterSave;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),visible=_useState2[0],setVisible=_useState2[1];var _useGetProcessData=useGetProcessData(),_useGetProcessData2=_slicedToArray(_useGetProcessData,2),loading=_useGetProcessData2[0],getProcessData=_useGetProcessData2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),status_arr=_useState4[0],setStatusArr=_useState4[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var setFieldsValue=form.setFieldsValue,getFieldValue=form.getFieldValue;var schedule_id=getFieldValue(['schedule','_id']);var _useGetStatus=useGetStatus(),_useGetStatus2=_slicedToArray(_useGetStatus,2),status_loading=_useGetStatus2[0].loading,getStatus=_useGetStatus2[1];var _useUpdateScheduleSta=useUpdateScheduleStatus(schedule_id),_useUpdateScheduleSta2=_slicedToArray(_useUpdateScheduleSta,2),saving=_useUpdateScheduleSta2[0],saveProcess=_useUpdateScheduleSta2[1];var fetchStatus=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getStatus,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getStatus();case 3:_yield$getStatus=_context.sent;data=_yield$getStatus.data;if(data===null||data===void 0?void 0:data.length){_context.next=7;break;}return _context.abrupt(\"return\");case 7:setStatusArr(data);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);messageError('2010110147');case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);})),[getStatus]);var fetchProcessData=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var _yield$getProcessData,data,normalized_data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return getProcessData(id);case 3:_yield$getProcessData=_context2.sent;data=_yield$getProcessData.data;if(data===null||data===void 0?void 0:data.success){_context2.next=8;break;}message.error(data.message);return _context2.abrupt(\"return\");case 8:normalized_data=normalizeData(data);setFieldsValue(normalized_data);_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);message.error('Não foi possível carregar os dados do processo. Recarregue a página e tente novamente. '+'Se persistir o erro entre em contato conosco pelo código:2010202212');case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),[getProcessData,setFieldsValue]);var open=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(process_id){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return fetchProcessData(process_id);case 2:_context3.next=4;return fetchStatus();case 4:setVisible(true);case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function open(_x2){return _ref4.apply(this,arguments);};}();var close=function close(){setVisible(false);};var handleOpenProcess=useCallback(function(){var process_id=getFieldValue(['processData','_id']);window.open(\"/process/\".concat(process_id));setTimeout(function(){return close();},500);},[getFieldValue]);var handleUpdateStatus=useCallback(/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(status_id){var _yield$saveProcess,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return saveProcess(status_id);case 3:_yield$saveProcess=_context4.sent;data=_yield$saveProcess.data;if(data.success){_context4.next=8;break;}message.error(data.message);return _context4.abrupt(\"return\");case 8:successModal({content:'Status atualizado com sucesso'});afterSave===null||afterSave===void 0?void 0:afterSave();_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](0);message.error('Não foi possível salvar o status do agendamento. Recarregue a página e tente novamente. '+'Se persistir o erro entre em contato conosco pelo código:1110200326');case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[0,12]]);}));return function(_x3){return _ref5.apply(this,arguments);};}(),[afterSave,saveProcess]);useImperativeHandle(ref,function(){return{open:open,close:close};});return/*#__PURE__*/React.createElement(Modal,{visible:visible,closable:false,okText:\"Ir para Processo\",cancelText:\"Fechar\",onOk:handleOpenProcess,onCancel:close,centered:true,width:\"95%\"},/*#__PURE__*/React.createElement(Spin,{spinning:loading||status_loading||saving},/*#__PURE__*/React.createElement(Content,{form:form,status_arr:status_arr,handleUpdateStatus:handleUpdateStatus})));};ScheduleModal.displayName=\"ScheduleModal\";export default forwardRef(ScheduleModal);","map":null,"metadata":{},"sourceType":"module"}