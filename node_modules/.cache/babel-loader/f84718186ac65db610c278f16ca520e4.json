{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef,memo}from'react';import{Badge,Dropdown,message}from'antd';import{ReactComponent as NotificationSvg}from\"@svgr/webpack?-svgo,+titleProp,+ref!Assets/icons/notification.svg\";import{useUserSelector}from'Redux/UserReducer';import Icon from'@ant-design/icons';import NotificationList from'./NotificationList';import useHasNotification from'./useHasNotification';import useGetNotifications from'./useGetNotifications';import useReadNotification from'./useReadNotification';import messageError from'Utils/messageError';var NotificationIcon=function NotificationIcon(){var _has_notification_dat;var _useState=useState('geral'),_useState2=_slicedToArray(_useState,2),type=_useState2[0],setType=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),visible=_useState4[0],setVisible=_useState4[1];var _useHasNotification=useHasNotification(),_useHasNotification2=_slicedToArray(_useHasNotification,2),has_notification_data=_useHasNotification2[0].data,hasNotification=_useHasNotification2[1];var _useGetNotifications=useGetNotifications(),_useGetNotifications2=_slicedToArray(_useGetNotifications,2),_useGetNotifications3=_useGetNotifications2[0],loading=_useGetNotifications3.loading,data=_useGetNotifications3.data,getNotifications=_useGetNotifications2[1];var _useReadNotification=useReadNotification(),_useReadNotification2=_slicedToArray(_useReadNotification,1),readNotification=_useReadNotification2[0];var _ref=useUserSelector(function(state){return state.company;})||{},trial=_ref.trial,toHire=_ref.toHire;var trial_rest_days=useUserSelector(function(state){return state.trial_rest_days;});var permissions=useUserSelector(function(state){return state.permissions;});var fetchNotificationInterval=useRef(null);var has_notification=(_has_notification_dat=has_notification_data===null||has_notification_data===void 0?void 0:has_notification_data.notification)!==null&&_has_notification_dat!==void 0?_has_notification_dat:false;var fetchHasNotification=function fetchHasNotification(){if(fetchNotificationInterval.current)clearInterval(fetchNotificationInterval.current);fetchNotificationInterval.current=setInterval(hasNotification,1*60*1000);};useEffect(function(){if(toHire||trial&&trial_rest_days>0){setTimeout(hasNotification,1000);// Tem o timeout para dar tempo de setar o token do axios\nfetchHasNotification();}return function(){if(fetchNotificationInterval.current)clearInterval(fetchNotificationInterval.current);};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[toHire,trial,trial_rest_days]);useEffect(function(){if(visible&&has_notification)getNotifications();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[visible,has_notification]);var handleChangeType=function handleChangeType(event,new_type){event.preventDefault();setType(new_type);};var handleReadNotification=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var _yield$readNotificati,_data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return readNotification(id);case 3:_yield$readNotificati=_context.sent;_data=_yield$readNotificati.data;if(!(_data===null||_data===void 0?void 0:_data.success)){_context.next=9;break;}getNotifications();hasNotification();return _context.abrupt(\"return\");case 9:// Se não deu certo, é provavel que os próximos tbm irão falhar\nif(fetchNotificationInterval.current)clearInterval(fetchNotificationInterval.current);message.error('Não foi possível atualizar a notificação');_context.next=18;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);// Se não deu certo, é provavel que os próximos tbm irão falhar\nif(fetchNotificationInterval.current)clearInterval(fetchNotificationInterval.current);console.log(_context.t0);messageError('202010121846');case 18:case\"end\":return _context.stop();}}},_callee,null,[[0,13]]);}));return function handleReadNotification(_x){return _ref2.apply(this,arguments);};}();var notifications=data||[];var filtered_notifications=notifications.filter(function(notification){var movement_types=['movement','key_word'];if(type==='movimentation'&&movement_types.includes(notification.module.module_id))return true;return type==='geral'&&!movement_types.includes(notification.module.module_id);});var has_general_notification=notifications.some(function(notification){return!notification.module.module_id;});var has_movimentation_notification=notifications.some(function(notification){return notification.module.module_id;});return/*#__PURE__*/React.createElement(Dropdown,{overlay:function overlay(){return NotificationList({handleChangeType:handleChangeType,handleReadNotification:handleReadNotification,has_general_notification:has_general_notification,has_movimentation_notification:has_movimentation_notification,loading:loading,notifications:filtered_notifications,has_update_permission:permissions===null||permissions===void 0?void 0:permissions.notification.update});},trigger:['click'],placement:\"bottomRight\",visible:visible,onVisibleChange:setVisible},/*#__PURE__*/React.createElement(Badge,{offset:[-14,7],status:has_notification?'success':undefined},/*#__PURE__*/React.createElement(Icon,{component:NotificationSvg,style:{fontSize:'24px',marginRight:'8px',cursor:'pointer'}})));};NotificationIcon.displayName=\"NotificationIcon\";export default memo(NotificationIcon);","map":null,"metadata":{},"sourceType":"module"}