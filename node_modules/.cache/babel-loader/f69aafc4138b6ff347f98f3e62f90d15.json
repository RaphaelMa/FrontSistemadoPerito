{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _objectWithoutProperties from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{forwardRef,useCallback,useImperativeHandle,useState,memo}from'react';import{Modal,Spin,Form}from'antd';import useGetTask from'./useGetTask';import TaskForm from'./TaskForm';import Footer from'./Footer';import moment from'moment';import useSaveTask from'./useSaveTask';import messageError from'Utils/messageError';import useDestroyTask from'./useDestroyTask';import History from'./History/History';var TaskModal=function TaskModal(_ref,ref){var afterSave=_ref.afterSave,afterDeleteTask=_ref.afterDeleteTask;var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var submit=form.submit,setFieldsValue=form.setFieldsValue,resetFields=form.resetFields;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),visible=_useState2[0],setVisible=_useState2[1];var _useState3=useState(undefined),_useState4=_slicedToArray(_useState3,2),task_id=_useState4[0],setTaskId=_useState4[1];var _useState5=useState(undefined),_useState6=_slicedToArray(_useState5,2),old_column=_useState6[0],setOldColumn=_useState6[1];var _useGetTask=useGetTask(),_useGetTask2=_slicedToArray(_useGetTask,2),loadTask=_useGetTask2[0],loading=_useGetTask2[1].loading;var _useSaveTask=useSaveTask(),_useSaveTask2=_slicedToArray(_useSaveTask,2),saveTask=_useSaveTask2[0],save_loading=_useSaveTask2[1].loading;var _useDestroyTask=useDestroyTask(),_useDestroyTask2=_slicedToArray(_useDestroyTask,2),deleteTask=_useDestroyTask2[0],delete_loading=_useDestroyTask2[1].loading;var open=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(task_id,initial_data){var _yield$loadTask,data,task,_ref3,createAt,deliveryDate,finishedDate,rest,values;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setTaskId(task_id);setVisible(true);if(initial_data){// @ts-ignore\nsetFieldsValue(initial_data);}if(task_id){_context.next=5;break;}return _context.abrupt(\"return\");case 5:_context.next=7;return loadTask(task_id);case 7:_yield$loadTask=_context.sent;data=_yield$loadTask.data;task=data.task;setOldColumn(task===null||task===void 0?void 0:task.column_id);_ref3=task||{},createAt=_ref3.createAt,deliveryDate=_ref3.deliveryDate,finishedDate=_ref3.finishedDate,rest=_objectWithoutProperties(_ref3,[\"createAt\",\"deliveryDate\",\"finishedDate\"]);values=_objectSpread({},rest,{deliveryDate:deliveryDate?moment(deliveryDate).utc():undefined,createAt:createAt?moment(createAt).utc():undefined,finishedDate:finishedDate?moment(finishedDate).utc():undefined});setFieldsValue(values);case 14:case\"end\":return _context.stop();}}},_callee);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}(),[loadTask,setFieldsValue]);var close=useCallback(function(){setTaskId(undefined);setVisible(false);setTimeout(function(){return resetFields();},100);},[resetFields]);var onFinish=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(raw_values){var createAt,deliveryDate,finishedDate,rest,values,_yield$saveTask,data,success,_task;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:createAt=raw_values.createAt,deliveryDate=raw_values.deliveryDate,finishedDate=raw_values.finishedDate,rest=_objectWithoutProperties(raw_values,[\"createAt\",\"deliveryDate\",\"finishedDate\"]);values=_objectSpread({},rest,{deliveryDate:deliveryDate.utc().format('YYYY-MM-DD'),createAt:createAt===null||createAt===void 0?void 0:createAt.utc().format('YYYY-MM-DD'),finishedDate:finishedDate===null||finishedDate===void 0?void 0:finishedDate.utc().format('YYYY-MM-DD')});_context2.prev=2;_context2.next=5;return saveTask(values);case 5:_yield$saveTask=_context2.sent;data=_yield$saveTask.data;success=data.success,_task=data.task;if(success){close();afterSave===null||afterSave===void 0?void 0:afterSave(_task,old_column);}_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](2);messageError('202106031552');case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[2,11]]);}));return function onFinish(_x3){return _ref4.apply(this,arguments);};}();var handleDelete=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _yield$deleteTask,data,_ref6,success;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return deleteTask(task_id);case 3:_yield$deleteTask=_context3.sent;data=_yield$deleteTask.data;_ref6=data||{},success=_ref6.success;if(success){_context3.next=9;break;}messageError('202106031647');return _context3.abrupt(\"return\");case 9:afterDeleteTask===null||afterDeleteTask===void 0?void 0:afterDeleteTask(old_column,task_id);close();_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](0);messageError('202106031648');case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[0,13]]);}));return function handleDelete(){return _ref5.apply(this,arguments);};}();useImperativeHandle(ref,function(){return{open:open,close:close};});return/*#__PURE__*/React.createElement(Modal,{visible:visible,destroyOnClose:true,closable:true,onCancel:close,centered:true,title:!!task_id?'Editar tarefa':'Nova tarefa',width:650,footer:null},/*#__PURE__*/React.createElement(Spin,{spinning:loading},/*#__PURE__*/React.createElement(Form,{form:form,layout:\"vertical\",onFinish:onFinish},/*#__PURE__*/React.createElement(TaskForm,{setFieldsValue:setFieldsValue})),/*#__PURE__*/React.createElement(History,{task_id:task_id}),/*#__PURE__*/React.createElement(Footer,{has_id:!!task_id,submit:submit,close:close,handleDelete:handleDelete,loading:save_loading||delete_loading})));};TaskModal.displayName=\"TaskModal\";export default memo(forwardRef(TaskModal));","map":null,"metadata":{},"sourceType":"module"}