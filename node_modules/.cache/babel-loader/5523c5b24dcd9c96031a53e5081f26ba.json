{"ast":null,"code":"import _defineProperty from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useMemo,useState}from'react';import{message}from'antd';import EmptyComponent from'Components/EmptyComponent/EmptyComponent';import moment from'moment';import{useNavigate}from'react-router';import{useUserSelector}from'Redux/UserReducer';import{scapeRegex,removeFalsyValues}from'Utils/functions';import messageError from'Utils/messageError';import Header from'./Header';import processModal from'./processModal';import Table from'./ProcessTable';import useColumns from'./useColumns';import useDestroyProcess from'./useDestroyProcess';import useGetProcesses from'./useGetProcesses';import styled from'styled-components';import{cloneDeep,uniqBy}from'lodash';import useGetVisibleColumns from'./useGetVisibleColumns';import useSaveVisibleColumns from'./useSaveVisibleColumns';import useSaveStorage from'../../Utils/useSaveStorage';import useExportData from'./useExportData';var multiple_select_array=['financialSituation_id','situation_id','judicialDistrict_id','nature_id','multicompany_id','statusImpeachment_id'];export var INITIAL_FILTERS={pagination:{current_page:1,page_size:20},sort:{field:'processNumber',order:'ascend'},dates:undefined,person_id:undefined};var ProcessList=function ProcessList(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),visible_columns=_useState2[0],setVisibleColumns=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useSaveStorage=useSaveStorage('process-filters-list',INITIAL_FILTERS),_useSaveStorage2=_slicedToArray(_useSaveStorage,2),filters=_useSaveStorage2[0],setFilters=_useSaveStorage2[1];var permissions=useUserSelector(function(state){return state.permissions;});var _useGetProcesses=useGetProcesses(),_useGetProcesses2=_slicedToArray(_useGetProcesses,2),loading=_useGetProcesses2[0].loading,getProcesses=_useGetProcesses2[1];var _useGetVisibleColumns=useGetVisibleColumns(),_useGetVisibleColumns2=_slicedToArray(_useGetVisibleColumns,2),columns_loading=_useGetVisibleColumns2[0].loading,getVisibleColumns=_useGetVisibleColumns2[1];var _useSaveVisibleColumn=useSaveVisibleColumns(),_useSaveVisibleColumn2=_slicedToArray(_useSaveVisibleColumn,2),saveVisibleColumns=_useSaveVisibleColumn2[0],save_columns_loading=_useSaveVisibleColumn2[1].loading;var _useDestroyProcess=useDestroyProcess(),_useDestroyProcess2=_slicedToArray(_useDestroyProcess,2),destroyProcess=_useDestroyProcess2[0],destroy_loading=_useDestroyProcess2[1].loading;var navigate=useNavigate();var loadProcesses=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var columns_response,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getVisibleColumns();case 3:columns_response=_context.sent;setVisibleColumns(columns_response.data);_context.next=7;return getProcesses();case 7:response=_context.sent;setData(response.data);_context.next=14;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);messageError('202008252245');case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function loadProcesses(){return _ref.apply(this,arguments);};}();useEffect(function(){loadProcesses();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);var handleOpenDrawer=function handleOpenDrawer(id){if(id){var process=data.find(function(process){return process._id===id;});process.statusImport_key==='importing'?processModal():navigate(\"/process/\".concat(id));}else{navigate('/process');}};var onPressEnter=useCallback(function(value,object_key){setFilters(function(old_filters){return _objectSpread({},old_filters,_defineProperty({},object_key,scapeRegex(value)));});},[setFilters]);var handleDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return destroyProcess(id);case 3:response=_context2.sent;if(response.data.success){message.success('Processo excluído com sucesso');setData(function(prev){return prev.filter(function(process){return process._id!==id;});});}_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);messageError('202008262002');case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function handleDelete(_x){return _ref2.apply(this,arguments);};}();var handleTableChange=useCallback(function(pagination,filter,sorter){var _sorter$column;var internal_filters=filters;if(sorter===null||sorter===void 0?void 0:(_sorter$column=sorter.column)===null||_sorter$column===void 0?void 0:_sorter$column.sorter){internal_filters=_objectSpread({},internal_filters,{sort:{order:sorter.order,field:sorter.field}});}internal_filters=_objectSpread({},internal_filters,{pagination:{current_page:pagination.current||internal_filters.pagination.current_page,page_size:pagination.pageSize||internal_filters.pagination.page_size}});setFilters(internal_filters);},[filters,setFilters]);var updateProcessPushStatus=function updateProcessPushStatus(process_id,status){setData(function(old_processes){var index=old_processes.findIndex(function(p){return p._id===process_id;});var process=_objectSpread({},old_processes[index],{statusProcessMonitoring:status});var new_processes=cloneDeep(old_processes);new_processes[index]=process;return new_processes;});};var updateProcessFavorite=function updateProcessFavorite(process_id,value){setData(function(old_processes){var index=old_processes.findIndex(function(p){return p._id===process_id;});var process=_objectSpread({},old_processes[index],{favorite:value});var new_processes=cloneDeep(old_processes);new_processes[index]=process;return new_processes;});};var locale=useMemo(function(){return{emptyText:(permissions===null||permissions===void 0?void 0:permissions.process.create)&&/*#__PURE__*/React.createElement(EmptyComponent,{onClick:function onClick(){return handleOpenDrawer();},action_text:\"Processo\"})// eslint-disable-next-line react-hooks/exhaustive-deps\n};},[permissions]);var columns=useColumns({handleDelete:handleDelete,handleEdit:handleOpenDrawer,updateProcessPushStatus:updateProcessPushStatus,updateProcessFavorite:updateProcessFavorite,visible_columns:visible_columns});var filterByPersonId=useCallback(function(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var person_id=arguments.length>1?arguments[1]:undefined;return data===null||data===void 0?void 0:data.some(function(item){return item.people.people_id===person_id;});},[]);var filtered_data=useMemo(function(){var filtered_data=data.filter(function(process){return Object.keys(removeFalsyValues(filters)).filter(function(filter){return filter!=='pagination'&&filter!=='sort'&&filter!=='search';}).reduce(function(acc,key){if(key==='person_id'){var person_id=filters[key];var person=filterByPersonId(process===null||process===void 0?void 0:process.peoples,person_id);var active_pole_person=filterByPersonId(process===null||process===void 0?void 0:process.activePole,person_id);var passive_pole_person=filterByPersonId(process===null||process===void 0?void 0:process.passivePole,person_id);var has_person=person||active_pole_person||passive_pole_person;return acc&&has_person;}if(key==='kind_person_id'){var kind_person_id=filters.kind_person_id;var person_keys_arr=['peoples','activePole','passivePole'];var testKindPersonId=function testKindPersonId(people){return kind_person_id.includes(people.kindPeople.kindPeople_id);};return person_keys_arr.reduce(function(acc,key){var _process$key;return acc||!!((_process$key=process[key])===null||_process$key===void 0?void 0:_process$key.some(testKindPersonId));},false);}if(key==='dates'){var start_date=filters.dates[0];var end_date=filters.dates[1];var date=moment(process.createAt,'YYYY-MM-DD');return acc&&date.isBetween(start_date,end_date,'days','[]');}// quando são multiplos\nif(multiple_select_array.includes(key)){var _filters$key;// @ts-ignore\nreturn acc&&!!((_filters$key=filters[key])===null||_filters$key===void 0?void 0:_filters$key.includes(process[key]||''));}// @ts-ignore\nreturn acc&&process[key]===filters[key];},true);});var max_page=Math.ceil(filtered_data.length/filters.pagination.page_size);if(max_page<filters.pagination.current_page&&filters.pagination.current_page!==Math.max(max_page,1)){setFilters(function(prev){return _objectSpread({},prev,{pagination:_objectSpread({},prev.pagination,{current_page:Math.max(max_page,1)})});});}return filtered_data;},[data,filters,filterByPersonId,setFilters]);var handleSaveVisibleColumns=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var response;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(visible_columns){_context3.next=2;break;}return _context3.abrupt(\"return\");case 2:_context3.prev=2;_context3.next=5;return saveVisibleColumns(visible_columns);case 5:response=_context3.sent;if(response.data.success){message.success('Colunas atualizadas com sucesso!');}_context3.next=12;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](2);messageError('202103282022');case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[2,9]]);})),[saveVisibleColumns,visible_columns]);var non_duplicated_process_number=useMemo(function(){return uniqBy(data,'processNumber').filter(function(proc){return proc.processNumber;});},[data]);var exportToXLS=useExportData(filtered_data,visible_columns);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Header,{filters:filters,onPressEnter:onPressEnter,setFilters:setFilters,button_text:\"Novo Processo\",handleNew:handleOpenDrawer,process_number:non_duplicated_process_number,visible_columns:visible_columns,setVisibleColumns:setVisibleColumns,columns_loading:columns_loading,handleSaveVisibleColumns:handleSaveVisibleColumns,save_columns_loading:save_columns_loading,exportToXLS:exportToXLS}),/*#__PURE__*/React.createElement(Table,{columns:columns,filtered_data:filtered_data,filters:filters,handleTableChange:handleTableChange,loading:loading||destroy_loading,locale:locale}));};ProcessList.displayName=\"ProcessList\";export default ProcessList;var Container=styled.div.withConfig({displayName:\"ProcessList__Container\",componentId:\"sc-9ny49c-0\"})([\"height:100%;width:100%;padding:0 2rem 2rem;\"]);","map":null,"metadata":{},"sourceType":"module"}