{"ast":null,"code":"import _toConsumableArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import{filterData,scapeRegex}from'Utils/functions';import styled from'styled-components';import moment,{defaultFormat}from'moment';import{Form,message}from'antd';import FinancialDrawer from'Components/Drawers/Financial/FinancialDrawer';import messageError from'Utils/messageError';import useGetFinancial from'./useGetFinancial';import FinancialTable from'./FinancialTable';import Header from'./Header';import useExportData from'./useExportData';var initial_filters={search:'',pagination:{current_page:1,page_size:20},sort:{field:'expirationDate',order:'ascend'}};export var initial_headers_filters={start_date:moment().startOf('month'),end_date:moment().endOf('month'),isPaid:undefined,movement_description:undefined,financialAccount_id:undefined};var columns_keys=['process_number','people_name','category_description'];var initial_general_financial={total:0,receive:0,pay:0};var Financial=function Financial(){var _useState=useState(initial_general_financial),_useState2=_slicedToArray(_useState,2),general_financial=_useState2[0],setGeneralFinancial=_useState2[1];var _useState3=useState(initial_headers_filters),_useState4=_slicedToArray(_useState3,2),header_filters=_useState4[0],setHeaderFilters=_useState4[1];var _useState5=useState(initial_filters),_useState6=_slicedToArray(_useState5,2),filters=_useState6[0],setFilters=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),financials=_useState8[0],setFinancials=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),header_key=_useState10[0],setHeaderKey=_useState10[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var financialModalRef=useRef(null);var _useGetFinancial=useGetFinancial(),_useGetFinancial2=_slicedToArray(_useGetFinancial,2),loading=_useGetFinancial2[0].loading,getFinancial=_useGetFinancial2[1];var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getFinancial,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getFinancial();case 3:_yield$getFinancial=_context.sent;data=_yield$getFinancial.data;if(data.success){_context.next=8;break;}message.error(data.message);return _context.abrupt(\"return\");case 8:setFinancials(data.financial);setGeneralFinancial(data.generalFinancial);_context.next=15;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](0);messageError('202012191938');case 15:case\"end\":return _context.stop();}}},_callee,null,[[0,12]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();useEffect(function(){fetchData();// eslint-disable-next-line\n},[]);var onPressEnter=useCallback(function(value){setFilters(function(old_filters){return _objectSpread({},old_filters,{search:scapeRegex(value)});});},[]);var handleOpenDrawer=function handleOpenDrawer(options){var _financialModalRef$cu;(_financialModalRef$cu=financialModalRef.current)===null||_financialModalRef$cu===void 0?void 0:_financialModalRef$cu.open(options);};var handleTableChange=useCallback(function(pagination,_filter,sorter){var _sorter$column;var internal_filters=filters;if(sorter===null||sorter===void 0?void 0:(_sorter$column=sorter.column)===null||_sorter$column===void 0?void 0:_sorter$column.sorter){internal_filters=_objectSpread({},internal_filters,{sort:{order:sorter.order,field:sorter.field}});}internal_filters=_objectSpread({},internal_filters,{pagination:{current_page:pagination.current||internal_filters.pagination.current_page,page_size:pagination.pageSize||internal_filters.pagination.page_size}});setFilters(function(old_filters){return _objectSpread({},old_filters,{},internal_filters);});},[filters]);var handleFormChange=function handleFormChange(changedFields){if(!changedFields.length)return;var field=changedFields[0];var value=field.value;if(field.name[0]==='isPaid'&&typeof field.value==='string'){value=field.value==='true';}setHeaderFilters(function(old_filters){return _objectSpread({},old_filters,_defineProperty({},field.name,value));});};var afterSave=function afterSave(data){setHeaderKey(String(Math.floor(Math.random()*100)));if(!data)return;var financial=data.financial,generalFinancial=data.generalFinancial;setFinancials(function(prev){var prev_financial=prev.find(function(f){return f._id===financial._id;});if(prev_financial){var _financials=prev.filter(function(f){return f._id!==financial._id;});return[].concat(_toConsumableArray(_financials),[financial]);}return[].concat(_toConsumableArray(prev),[financial]);});setGeneralFinancial(generalFinancial);};var filtered_data_by_header_filters=useMemo(function(){var start_date=header_filters.start_date,end_date=header_filters.end_date,isPaid=header_filters.isPaid,movement_description=header_filters.movement_description,financialAccount_id=header_filters.financialAccount_id;return financials.filter(function(movement){var has_filter=true;if(typeof isPaid==='boolean'){has_filter=movement.isPaid===isPaid;}if(!has_filter)return false;if(typeof financialAccount_id==='string'){has_filter=movement.financialAccount_id===financialAccount_id;}if(!has_filter)return false;if(typeof movement_description==='string'){has_filter=movement.movement_description===movement_description;}if(!has_filter)return false;return moment(movement===null||movement===void 0?void 0:movement.expirationDate,defaultFormat).isBetween(start_date,end_date,'days','[]');});},[header_filters,financials]);var filtered_data=useMemo(function(){return filterData({data:filtered_data_by_header_filters,filters:filters,columns_keys:columns_keys});},[filters,filtered_data_by_header_filters]);var exportToXLS=useExportData(filtered_data);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Header,{key:header_key,general_financial:general_financial,handleFormChange:handleFormChange,form:form,onPressEnter:onPressEnter,setFilters:setFilters,handleOpenDrawer:handleOpenDrawer,exportToXLS:exportToXLS}),/*#__PURE__*/React.createElement(FinancialTable,{loading:loading,financials:filtered_data,setFinancials:setFinancials,setGeneralFinancial:setGeneralFinancial,handleTableChange:handleTableChange,handleOpenDrawer:handleOpenDrawer,afterSave:afterSave,header_height:124.797}),/*#__PURE__*/React.createElement(FinancialDrawer,{afterSave:afterSave,ref:financialModalRef}));};Financial.displayName=\"Financial\";export default Financial;var Container=styled.div.withConfig({displayName:\"Financial__Container\",componentId:\"sc-1jb4uqs-0\"})([\"width:100%;padding:2rem;height:calc(100vh - 4rem);\"]);","map":null,"metadata":{},"sourceType":"module"}