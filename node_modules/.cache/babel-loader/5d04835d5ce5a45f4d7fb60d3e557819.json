{"ast":null,"code":"import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{forwardRef,useImperativeHandle,useState}from'react';import{Button,Drawer,Form,message,Spin}from'antd';import FinancialForm from'./FinancialForm';import styled from'styled-components';import useSaveFinancial from'./useSaveFinancial';import useGetFinancial from'./useGetFinancial';import messageError from'Utils/messageError';import successModal from'Utils/successModal';import moment,{defaultFormat}from'moment';var FinancialDrawer=function FinancialDrawer(_ref,ref){var afterSave=_ref.afterSave;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),visible=_useState2[0],setVisible=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),is_paid=_useState4[0],setIsPaid=_useState4[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var _useSaveFinancial=useSaveFinancial(),_useSaveFinancial2=_slicedToArray(_useSaveFinancial,2),saveMutation=_useSaveFinancial2[0],saving=_useSaveFinancial2[1];var _useGetFinancial=useGetFinancial(),_useGetFinancial2=_slicedToArray(_useGetFinancial,2),_useGetFinancial2$=_useGetFinancial2[0],loading=_useGetFinancial2$.loading,data=_useGetFinancial2$.data,getJudicialDistrict=_useGetFinancial2[1];var loadData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){var _yield$getJudicialDis,financial,financial_format;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getJudicialDistrict(id);case 3:_yield$getJudicialDis=_context.sent;financial=_yield$getJudicialDis.data.financial;financial_format={_id:financial._id,isPaid:financial.isPaid,expirationDate:financial.expirationDate?moment(financial.expirationDate,defaultFormat):null,movement_id:financial.movement_id,category_id:financial.category_id,process_id:financial.process_id,people_id:financial.people_id,value:financial.value,discount:financial.discount,financialAccount_id:financial.financialAccount_id,observation:financial.observation};setIsPaid(financial.isPaid);form.setFieldsValue(financial_format);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);messageError('202012191615');case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function loadData(_x){return _ref2.apply(this,arguments);};}();var handleChangeReverse=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var financial,financial_format,_yield$save,success,save_data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:financial=data.financial;financial_format={_id:financial._id,isPaid:false,expirationDate:financial.expirationDate,movement_id:financial.movement_id,category_id:financial.category_id,process_id:financial.process_id,people_id:financial.people_id,value:financial.value,discount:financial.discount,financialAccount_id:financial.financialAccount_id,observation:financial.observation};_context2.next=4;return save(financial_format);case 4:_yield$save=_context2.sent;success=_yield$save.success;save_data=_yield$save.data;if(success){_context2.next=9;break;}return _context2.abrupt(\"return\");case 9:successModal({content:'Movimentação estornada!'});afterSave===null||afterSave===void 0?void 0:afterSave(save_data);setIsPaid(false);form.setFieldsValue(_objectSpread({},financial_format,{expirationDate:moment(financial.expirationDate)}));case 13:case\"end\":return _context2.stop();}}},_callee2);}));return function handleChangeReverse(){return _ref3.apply(this,arguments);};}();var open=function open(id,process_id){if(id){loadData(id);}if(process_id){form.setFieldsValue({process_id:process_id});}setVisible(true);};var close=function close(){setVisible(false);setTimeout(function(){setIsPaid(false);form.resetFields();},300);};useImperativeHandle(ref,function(){return{open:open,close:close};});var save=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(values){var _yield$saveMutation,_data;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return saveMutation(values);case 3:_yield$saveMutation=_context3.sent;_data=_yield$saveMutation.data;if(_data===null||_data===void 0?void 0:_data.success){_context3.next=8;break;}message.error(_data.message);return _context3.abrupt(\"return\",{success:false});case 8:return _context3.abrupt(\"return\",{success:true,data:_data});case 11:_context3.prev=11;_context3.t0=_context3[\"catch\"](0);messageError('202012301710');return _context3.abrupt(\"return\",{success:false});case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[0,11]]);}));return function save(_x2){return _ref4.apply(this,arguments);};}();var handleSave=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var raw_values,values,_yield$save2,success,data;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return form.validateFields();case 2:raw_values=_context4.sent;values=_objectSpread({},raw_values,{expirationDate:raw_values.expirationDate.format('YYYY-MM-DD')});_context4.next=6;return save(values);case 6:_yield$save2=_context4.sent;success=_yield$save2.success;data=_yield$save2.data;if(success){_context4.next=11;break;}return _context4.abrupt(\"return\");case 11:successModal({content:'Movimentação salva com sucesso!'});afterSave===null||afterSave===void 0?void 0:afterSave(data);close();case 14:case\"end\":return _context4.stop();}}},_callee4);}));return function handleSave(){return _ref5.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(Drawer,{visible:visible,onClose:close,title:\"Movimenta\\xE7\\xE3o\",width:700,destroyOnClose:true,footer:/*#__PURE__*/React.createElement(Footer,null,/*#__PURE__*/React.createElement(Button,{onClick:close},\"Cancelar\"),/*#__PURE__*/React.createElement(Button,{disabled:is_paid||loading,loading:saving,onClick:handleSave,type:\"primary\"},\"Salvar\"))},/*#__PURE__*/React.createElement(Spin,{spinning:loading||saving},/*#__PURE__*/React.createElement(FinancialForm,{afterSave:afterSave,form:form,is_paid:is_paid,handleChangeReverse:handleChangeReverse})));};FinancialDrawer.displayName=\"FinancialDrawer\";export default forwardRef(FinancialDrawer);var Footer=styled.div.withConfig({displayName:\"FinancialDrawer__Footer\",componentId:\"sc-3bx2to-0\"})([\"text-align:right;button + button{margin-left:8px;}\"]);","map":null,"metadata":{},"sourceType":"module"}