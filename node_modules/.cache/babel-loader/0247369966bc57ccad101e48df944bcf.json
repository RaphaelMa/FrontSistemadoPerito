{"ast":null,"code":"import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useMemo,useRef,useState}from'react';import useGetTasks from'./useGetTasks';import messageError from'Utils/messageError';import Header from'../Kanban/Header';import styled from'styled-components';import moment from'moment';import Table from'./Table';import TaskModal from'Components/Modals/TaskModal/TaskModal';import TaskColumnModal from'Components/Modals/TaskColumn/TaskColumnModal';import useDestroyTask from'Components/Modals/TaskModal/useDestroyTask';import{cloneDeep}from'lodash';import useExportData from'./useExportData';var List=function List(){var taskModalRef=useRef(null);var taskColumnModalRef=useRef(null);var _useGetTasks=useGetTasks(),_useGetTasks2=_slicedToArray(_useGetTasks,2),loading=_useGetTasks2[0].loading,getTasks=_useGetTasks2[1];var _useDestroyTask=useDestroyTask(),_useDestroyTask2=_slicedToArray(_useDestroyTask,1),deleteTask=_useDestroyTask2[0];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),tasks=_useState2[0],setTasks=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),filters=_useState4[0],setFilters=_useState4[1];var fetchData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getTasks,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return getTasks();case 3:_yield$getTasks=_context.sent;data=_yield$getTasks.data;setTasks(data.task||[]);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);messageError('202102271547');case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function fetchData(){return _ref.apply(this,arguments);};}();useEffect(function(){fetchData();// eslint-disable-next-line\n},[]);var destroyTask=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var _yield$deleteTask,data,_ref3,success;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return deleteTask(id);case 3:_yield$deleteTask=_context2.sent;data=_yield$deleteTask.data;_ref3=data||{},success=_ref3.success;if(success)fetchData();_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);messageError('202106042250');case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,9]]);}));return function destroyTask(_x){return _ref2.apply(this,arguments);};}();var updateTaskFinished=function updateTaskFinished(task){setTasks(function(old_tasks){var index=old_tasks.findIndex(function(t){return t._id===task._id;});var new_tasks=cloneDeep(old_tasks);new_tasks[index]=task;return new_tasks;});};var filtered_data=useMemo(function(){var filtered_tasks=tasks.filter(function(task){if(filters.start_date&&moment(task.deliveryDate,'YYYY-MM-DD').isBefore(filters.start_date))return false;if(filters.end_date&&moment(task.deliveryDate,'YYYY-MM-DD').isAfter(filters.end_date))return false;if(filters.finished!==undefined&&filters.finished!==task.finished)return false;if(filters.process_id&&filters.process_id!==task.process_id)return false;if(filters.column_id&&filters.column_id!==task.column_id)return false;if(filters.user_id&&filters.user_id!==task.user_id)return false;return true;});return filtered_tasks;},[filters,tasks]);var exportToXLS=useExportData(filtered_data);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Header,{setFilters:setFilters,type:\"list\",openTaskModal:function openTaskModal(){var _taskModalRef$current;return(_taskModalRef$current=taskModalRef.current)===null||_taskModalRef$current===void 0?void 0:_taskModalRef$current.open();},openColumnModal:function openColumnModal(){var _taskColumnModalRef$c;return(_taskColumnModalRef$c=taskColumnModalRef.current)===null||_taskColumnModalRef$c===void 0?void 0:_taskColumnModalRef$c.open();},exportToXLS:exportToXLS}),/*#__PURE__*/React.createElement(Table,{loading:loading,tasks:filtered_data,handleDelete:destroyTask,handleEdit:function handleEdit(id){var _taskModalRef$current2;return(_taskModalRef$current2=taskModalRef.current)===null||_taskModalRef$current2===void 0?void 0:_taskModalRef$current2.open(id);},updateTaskFinished:updateTaskFinished}),/*#__PURE__*/React.createElement(TaskModal,{ref:taskModalRef,afterSave:function afterSave(){return fetchData();},afterDeleteTask:function afterDeleteTask(){return fetchData();}}),/*#__PURE__*/React.createElement(TaskColumnModal,{ref:taskColumnModalRef}));};List.displayName=\"List\";export default List;var Container=styled.div.withConfig({displayName:\"List__Container\",componentId:\"sc-1cv0yev-0\"})([\"height:calc(100vh - 5rem);padding:0 2rem 2rem 0;\"]);","map":null,"metadata":{},"sourceType":"module"}