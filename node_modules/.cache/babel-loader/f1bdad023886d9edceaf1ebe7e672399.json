{"ast":null,"code":"import _objectSpread from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/raphael/Documents/Github/FrontSistemadoPerito/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useMemo,useState,useRef}from'react';import useGetProcessTasks from'./useGetProcessTasks';import messageError from'Utils/messageError';import styled from'styled-components';import{Button,Col}from'antd';import{useParams}from'react-router';import{filterData}from'Utils/functions';import{useUserSelector}from'Redux/UserReducer';import PermissionsContainer from'Components/Permissions/Container';import useDestroyTask from'Components/Modals/TaskModal/useDestroyTask';import MenuTop from'Pages/NewProcess/MenuTop';import TasksTable from'./TasksTable';import useSaveTask from'Components/Modals/TaskModal/useSaveTask';import TaskModal from'Components/Modals/TaskModal/TaskModal';import successModal from'Utils/successModal';var initial_filters={pagination:{current_page:1,page_size:20},sort:{field:'expirationDate',order:'ascend'}};var ProcessTasks=function ProcessTasks(){var _useParams=useParams(),id=_useParams.id;var permissions=useUserSelector(function(state){return state.permissions;});var plan_modules=useUserSelector(function(state){var _state$company;return(_state$company=state.company)===null||_state$company===void 0?void 0:_state$company.plan.modules;});var taskModalRef=useRef(null);var _useDestroyTask=useDestroyTask(),_useDestroyTask2=_slicedToArray(_useDestroyTask,1),destroy=_useDestroyTask2[0];var _useSaveTask=useSaveTask(),_useSaveTask2=_slicedToArray(_useSaveTask,1),saveTask=_useSaveTask2[0];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),tasks=_useState2[0],setTasks=_useState2[1];var _useState3=useState(initial_filters),_useState4=_slicedToArray(_useState3,2),filters=_useState4[0],setFilters=_useState4[1];var _useGetProcessTasks=useGetProcessTasks(id),_useGetProcessTasks2=_slicedToArray(_useGetProcessTasks,2),loading=_useGetProcessTasks2[0].loading,getFinancials=_useGetProcessTasks2[1];var fetchData=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getFinancials,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(!(plan_modules===null||plan_modules===void 0?void 0:plan_modules.Financial)||!(permissions===null||permissions===void 0?void 0:permissions.financial.read))){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.prev=2;_context.next=5;return getFinancials();case 5:_yield$getFinancials=_context.sent;data=_yield$getFinancials.data;setTasks(data.message||[]);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](2);messageError('202102271547');case 13:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);})),[getFinancials,permissions,plan_modules]);useEffect(function(){fetchData();// eslint-disable-next-line\n},[]);var handleDelete=useCallback(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(task_id){var _yield$destroy,data,_ref3,success;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return destroy(task_id);case 3:_yield$destroy=_context2.sent;data=_yield$destroy.data;_ref3=data||{},success=_ref3.success;if(success){_context2.next=9;break;}messageError('202106122322');return _context2.abrupt(\"return\");case 9:setTasks(function(old_tasks){return old_tasks.filter(function(task_item){return task_item._id!==task_id;});});_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](0);messageError('202106122323');case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[0,12]]);}));return function(_x){return _ref2.apply(this,arguments);};}(),[destroy]);var handleSave=useCallback(/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(task){var _yield$saveTask,data,success;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return saveTask(task);case 3:_yield$saveTask=_context3.sent;data=_yield$saveTask.data;success=data.success;if(success){_context3.next=9;break;}messageError('202106122326');return _context3.abrupt(\"return\");case 9:setTasks(function(old_tasks){return old_tasks.map(function(raw_task){return raw_task._id===task._id?task:raw_task;});});_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](0);messageError('202106031552');case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[0,12]]);}));return function(_x2){return _ref4.apply(this,arguments);};}(),[saveTask]);var handleTableChange=useCallback(function(pagination,_,sorter){var _sorter$column;var internal_filters=filters;if(sorter===null||sorter===void 0?void 0:(_sorter$column=sorter.column)===null||_sorter$column===void 0?void 0:_sorter$column.sorter){internal_filters=_objectSpread({},internal_filters,{sort:{order:sorter.order,field:sorter.field}});}internal_filters=_objectSpread({},internal_filters,{pagination:{current_page:pagination.current||internal_filters.pagination.current_page,page_size:pagination.pageSize||internal_filters.pagination.page_size}});setFilters(function(old_filters){return _objectSpread({},old_filters,{},internal_filters);});},[filters]);var handleAction=useCallback(function(action,task){if(action==='destroy'){handleDelete(task._id);}else if(action==='edit'){var _taskModalRef$current;taskModalRef===null||taskModalRef===void 0?void 0:(_taskModalRef$current=taskModalRef.current)===null||_taskModalRef$current===void 0?void 0:_taskModalRef$current.open(task._id);}else{handleSave(_objectSpread({},task,{finished:!task.finished}));}},[handleDelete,handleSave]);var filtered_data=useMemo(function(){return filterData({data:tasks,filters:filters,columns_keys:[]});},[filters,tasks]);var afterSave=useCallback(function(){successModal({content:'Tarefa salva com sucesso!'});fetchData();},[fetchData]);return/*#__PURE__*/React.createElement(PermissionsContainer,{has_module:plan_modules===null||plan_modules===void 0?void 0:plan_modules.Task,has_permission:permissions===null||permissions===void 0?void 0:permissions.task.read},/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(MenuTop,{activePage:\"tasks\",id:id}),/*#__PURE__*/React.createElement(Header,null,/*#__PURE__*/React.createElement(ButtonsWrapper,null,/*#__PURE__*/React.createElement(Button,{block:true,type:\"primary\"// @ts-ignore\n,onClick:function onClick(){var _taskModalRef$current2;return taskModalRef===null||taskModalRef===void 0?void 0:(_taskModalRef$current2=taskModalRef.current)===null||_taskModalRef$current2===void 0?void 0:_taskModalRef$current2.open('',{process_id:id});}},\"Nova Tarefa\"),/*#__PURE__*/React.createElement(Button,{href:\"/tasks\",target:\"_blank\",rel:\"noopener noreferrer\",type:\"primary\"},\"Ir Para Tarefas\"))),/*#__PURE__*/React.createElement(TasksTable,{loading:loading,handleAction:handleAction,tasks:filtered_data,handleTableChange:handleTableChange})),/*#__PURE__*/React.createElement(TaskModal,{afterSave:afterSave,ref:taskModalRef}));};ProcessTasks.displayName=\"ProcessTasks\";export default ProcessTasks;var Container=styled.div.withConfig({displayName:\"ProcessTasks__Container\",componentId:\"sc-1n2ky8i-0\"})([\"height:calc(100vh - 5rem);padding:2rem;\"]);var Header=styled.div.withConfig({displayName:\"ProcessTasks__Header\",componentId:\"sc-1n2ky8i-1\"})([\"display:flex;justify-content:flex-end;margin-bottom:10px;\"]);var ButtonsWrapper=styled(Col).withConfig({displayName:\"ProcessTasks__ButtonsWrapper\",componentId:\"sc-1n2ky8i-2\"})([\"display:flex;flex-direction:row;gap:8px;\"]);","map":null,"metadata":{},"sourceType":"module"}